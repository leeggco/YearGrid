(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2732:function(e,t,n){Promise.resolve().then(n.bind(n,5814))},5814:function(e,t,n){"use strict";n.d(t,{default:function(){return ec}});var l=n(7437),a=n(2265),r=n(7474),s=n(4405),i=n(6662),o=n(8700),c=n(6213),d=n(8971);function u(e,t,n){return Math.min(n,Math.max(t,e))}function m(e,t,n){return Math.min(n,Math.max(t,e))}var x=n(2258),h=n(9778),g=n(6739),b=n(646),f=n(9747),p=n(6062),v=n(2575),y=n(1519),w=n(7912),j=n(8986),N=n(888),S=n(6496);let z={0:{label:"未记录",emoji:"◻︎",dotClass:"hidden"},1:{label:"很差",emoji:"\uD83D\uDE23",dotClass:"bg-rose-400"},2:{label:"偏差",emoji:"\uD83D\uDE15",dotClass:"bg-amber-400"},3:{label:"一般",emoji:"\uD83D\uDE10",dotClass:"bg-zinc-400"},4:{label:"不错",emoji:"\uD83D\uDE42",dotClass:"bg-cyan-400"},5:{label:"很好",emoji:"\uD83D\uDE04",dotClass:"bg-emerald-600"}},D={0:"".concat(z[0].emoji," ").concat(z[0].label),1:"".concat(z[1].emoji," ").concat(z[1].label),2:"".concat(z[2].emoji," ").concat(z[2].label),3:"".concat(z[3].emoji," ").concat(z[3].label),4:"".concat(z[4].emoji," ").concat(z[4].label),5:"".concat(z[5].emoji," ").concat(z[5].label)};function k(e){var t,n;let{selectedDay:a,selectedEntry:r,modalRef:s,onClose:i,onStateChange:o,onNoteChange:c,activeStateButtonClass:d,onDelete:u,justSaved:m}=e,x=null!==(t=null==r?void 0:r.note)&&void 0!==t?t:"";return(0,l.jsx)("div",{className:"fixed inset-0 z-40 flex items-end justify-center bg-black/20 p-4 md:items-center",onMouseDown:e=>{e.target===e.currentTarget&&i()},children:(0,l.jsxs)("div",{ref:s,tabIndex:-1,role:"dialog","aria-modal":"true","aria-labelledby":"day-dialog-title-".concat(a.isoDate),className:"w-full max-w-[520px] rounded-2xl border border-zinc-200/70 bg-white/90 p-4 shadow-[0_22px_70px_rgba(0,0,0,0.14)] backdrop-blur-xl outline-none",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{id:"day-dialog-title-".concat(a.isoDate),className:"text-sm text-zinc-950",children:a.label}),(0,l.jsx)("div",{className:"mt-1 text-xs text-zinc-600",children:a.holiday?"节日：".concat(a.holiday):" "}),(0,l.jsxs)("div",{className:"mt-1 text-xs text-zinc-600",children:["体感：",D[null!==(n=null==r?void 0:r.state)&&void 0!==n?n:0]]})]}),(0,l.jsx)("div",{className:"min-h-[18px] text-xs font-medium text-emerald-600",children:m?"已保存":null})]}),(0,l.jsx)("div",{className:"mt-4 flex flex-wrap gap-2",children:[{state:0,label:"".concat(z[0].emoji," ").concat(z[0].label)},{state:1,label:"".concat(z[1].emoji," ").concat(z[1].label)},{state:2,label:"".concat(z[2].emoji," ").concat(z[2].label)},{state:3,label:"".concat(z[3].emoji," ").concat(z[3].label)},{state:4,label:"".concat(z[4].emoji," ").concat(z[4].label)},{state:5,label:"".concat(z[5].emoji," ").concat(z[5].label)}].map(e=>{var t;let n=(null!==(t=null==r?void 0:r.state)&&void 0!==t?t:0)===e.state;return(0,l.jsx)("button",{type:"button",className:"rounded-full border px-3 py-1 text-xs transition ".concat(n?d(e.state):"border-zinc-200 bg-white/60 text-zinc-700 hover:bg-white"),onClick:()=>o(e.state),children:e.label},e.state)})}),(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)("input",{type:"text",placeholder:"写点什么（可选，限 50 字）...",value:x,onChange:e=>c(e.target.value),className:"w-full rounded-xl border border-zinc-200/60 bg-white/50 px-3 py-2 text-xs text-zinc-900 placeholder-zinc-400 outline-none ring-zinc-900/5 transition focus:border-zinc-900/20 focus:bg-white focus:ring-4"})}),(0,l.jsx)("div",{className:"mt-4 flex justify-end",children:(0,l.jsx)("button",{type:"button",onClick:u,className:"text-xs text-rose-500 hover:text-rose-600 transition",children:"删除记录"})})]})})}var M=n(1131);function I(e){var t;let{tooltip:n,tooltipRef:a,todayStart:r,entries:s}=e,i=s[n.data.isoDate],o=null!==(t=null==i?void 0:i.state)&&void 0!==t?t:0,c=null==i?void 0:i.note.trim();return(0,l.jsxs)("div",{ref:a,className:"pointer-events-none fixed z-50 w-max max-w-[80vw] rounded-xl border border-zinc-200/70 bg-white/80 px-3 py-2 text-xs text-zinc-900 shadow-[0_14px_40px_rgba(0,0,0,0.10)] backdrop-blur-xl",style:{left:n.x,top:n.y},children:[(0,l.jsx)("div",{className:"tabular-nums text-zinc-950",children:n.data.label}),(0,l.jsx)("div",{className:"mt-1 text-zinc-600",children:"past"===n.data.state?"已过去 ".concat(Math.max(0,(0,M.w)(r,n.data.date))," 天"):"today"===n.data.state?"今天":"还剩 ".concat(Math.max(0,(0,M.w)(n.data.date,r))," 天")}),(0,l.jsxs)("div",{className:"mt-1 text-zinc-600",children:["体感：",D[o]]}),n.data.holiday?(0,l.jsxs)("div",{className:"text-xs font-medium text-zinc-500",children:["节日：",n.data.holiday]}):null,c?(0,l.jsxs)("div",{className:"text-xs font-medium text-zinc-500",children:["备注：",c.slice(0,24)]}):null]})}function O(e){var t,n,a,s;let{percent:i,percentText:o,timeRemainingText:c,elapsedDays:d,totalDays:u,viewMode:m,rangeStart:x,isCreatingRange:h,createRangePreview:g}=e,b=h?null!==(t=null==g?void 0:g.percent)&&void 0!==t?t:0:i,f=h?g?"".concat(Math.floor(g.percent).toString(),"%"):"--":o,p=h?null!==(n=null==g?void 0:g.remainingText)&&void 0!==n?n:"--":c,v=h?null!==(a=null==g?void 0:g.elapsedDays)&&void 0!==a?a:"--":"".concat(d," 天"),y=h?null!==(s=null==g?void 0:g.totalDays)&&void 0!==s?s:"--":"".concat(u," 天"),w="year"===m?(0,r.WU)(x,"yyyy年"):"month"===m?(0,r.WU)(x,"M月"):"week"===m?"本周":"区间";return(0,l.jsxs)("div",{className:"flex flex-col items-start gap-6 sm:flex-row sm:items-center",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsxs)("svg",{className:"h-32 w-32 -rotate-90",viewBox:"0 0 128 128",children:[(0,l.jsx)("defs",{children:(0,l.jsxs)("linearGradient",{id:"ygProgressGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[(0,l.jsx)("stop",{offset:"0%",stopColor:"rgb(5 150 105)"}),(0,l.jsx)("stop",{offset:"100%",stopColor:"rgb(14 116 144)"})]})}),(0,l.jsx)("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"8",fill:"none",className:"text-zinc-200"}),(0,l.jsx)("circle",{cx:"64",cy:"64",r:"56",stroke:"url(#ygProgressGradient)",strokeWidth:"8",fill:"none",strokeLinecap:"round",className:"transition-all duration-1000",strokeDasharray:"".concat(3.52*b," 352")})]}),(0,l.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[(0,l.jsx)("span",{className:"text-3xl font-bold text-zinc-900",children:f}),(0,l.jsx)("span",{className:"text-xs text-zinc-500",children:w})]})]}),(0,l.jsxs)("div",{className:"space-y-3 rounded-xl border border-zinc-200/60 bg-white p-4 shadow-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-zinc-500",children:"剩余时间"}),(0,l.jsx)("p",{className:"text-2xl font-semibold text-zinc-900 tabular-nums",children:p})]}),(0,l.jsxs)("div",{className:"flex gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-xs text-zinc-500",children:"已过"}),(0,l.jsx)("p",{className:"text-lg font-medium text-emerald-600 tabular-nums",children:v})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-xs text-zinc-500",children:"总计"}),(0,l.jsx)("p",{className:"text-lg font-medium text-zinc-900 tabular-nums",children:y})]})]}),(0,l.jsx)("div",{className:"h-2 w-48 overflow-hidden rounded-full bg-zinc-100",children:(0,l.jsx)("div",{className:"h-full rounded-full transition-all duration-1000",style:{width:"".concat(b,"%"),background:"linear-gradient(90deg, rgb(5 150 105), rgb(14 116 144))"}})})]})]})}var C=n(3810),E=n(2489),R=n(401),T=n(866),F=n(8867),_=n(8930),B=n(9397);let W={emerald:{dotBg:"bg-emerald-500",progressBg:"bg-emerald-50",progressText:"text-emerald-600",progressBarFrom:"from-emerald-500",progressBarTo:"to-teal-400",progressTag:"bg-emerald-50 text-emerald-600",dayToday:"bg-[#009C7B] text-white",dayMarked:"bg-[#7BC27E] text-zinc-900",dayPast:"bg-[#D8E9E4] text-zinc-700",dayFuture:"bg-[#EEF3F4] border border-zinc-200/60 text-zinc-900",dayRing:"ring-[#009C7B]/30",dayShadow:"shadow-[#009C7B]/25",dayFocusOutline:"focus-visible:outline-[#009C7B]/40"},blue:{dotBg:"bg-blue-500",progressBg:"bg-blue-50",progressText:"text-blue-600",progressBarFrom:"from-blue-500",progressBarTo:"to-cyan-400",progressTag:"bg-blue-50 text-blue-600",dayToday:"bg-blue-600 text-white",dayMarked:"bg-blue-300 text-zinc-900",dayPast:"bg-blue-100 text-blue-900",dayFuture:"bg-zinc-50 border border-zinc-200/60 text-zinc-900",dayRing:"ring-blue-600/30",dayShadow:"shadow-blue-600/25",dayFocusOutline:"focus-visible:outline-blue-600/40"},rose:{dotBg:"bg-rose-500",progressBg:"bg-rose-50",progressText:"text-rose-600",progressBarFrom:"from-rose-500",progressBarTo:"to-pink-400",progressTag:"bg-rose-50 text-rose-600",dayToday:"bg-rose-600 text-white",dayMarked:"bg-rose-300 text-zinc-900",dayPast:"bg-rose-100 text-rose-900",dayFuture:"bg-zinc-50 border border-zinc-200/60 text-zinc-900",dayRing:"ring-rose-600/30",dayShadow:"shadow-rose-600/25",dayFocusOutline:"focus-visible:outline-rose-600/40"},amber:{dotBg:"bg-amber-500",progressBg:"bg-amber-50",progressText:"text-amber-600",progressBarFrom:"from-amber-500",progressBarTo:"to-orange-400",progressTag:"bg-amber-50 text-amber-600",dayToday:"bg-amber-500 text-white",dayMarked:"bg-amber-300 text-zinc-900",dayPast:"bg-amber-100 text-amber-900",dayFuture:"bg-zinc-50 border border-zinc-200/60 text-zinc-900",dayRing:"ring-amber-500/30",dayShadow:"shadow-amber-500/25",dayFocusOutline:"focus-visible:outline-amber-600/40"},violet:{dotBg:"bg-violet-500",progressBg:"bg-violet-50",progressText:"text-violet-600",progressBarFrom:"from-violet-500",progressBarTo:"to-purple-400",progressTag:"bg-violet-50 text-violet-600",dayToday:"bg-violet-600 text-white",dayMarked:"bg-violet-300 text-zinc-900",dayPast:"bg-violet-100 text-violet-900",dayFuture:"bg-zinc-50 border border-zinc-200/60 text-zinc-900",dayRing:"ring-violet-600/30",dayShadow:"shadow-violet-600/25",dayFocusOutline:"focus-visible:outline-violet-600/40"},cyan:{dotBg:"bg-cyan-500",progressBg:"bg-cyan-50",progressText:"text-cyan-600",progressBarFrom:"from-cyan-500",progressBarTo:"to-sky-400",progressTag:"bg-cyan-50 text-cyan-600",dayToday:"bg-cyan-500 text-white",dayMarked:"bg-cyan-300 text-zinc-900",dayPast:"bg-cyan-100 text-cyan-900",dayFuture:"bg-zinc-50 border border-zinc-200/60 text-zinc-900",dayRing:"ring-cyan-500/30",dayShadow:"shadow-cyan-500/25",dayFocusOutline:"focus-visible:outline-cyan-600/40"}},A="emerald";function U(e){if(!e)return"—";try{let t=(0,x.D)(e);if(Number.isNaN(t.getTime()))return"—";return(0,r.WU)(t,"yyyy.MM.dd")}catch(e){return"—"}}function H(e){let{ranges:t,activeRangeId:n,onSelect:r,onAdd:o,onAddTemplate:c,onEdit:d,onDelete:u,onDuplicate:m,now:h,variant:g,open:b,onOpenChange:f}=e,p=(0,a.useMemo)(()=>[...t].reverse(),[t]);(0,a.useEffect)(()=>{if("drawer"!==g||!b)return;let e=e=>{"Escape"===e.key&&(null==f||f(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[b,f,g]);let v=(0,l.jsxs)("div",{className:"flex h-full flex-col gap-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"text-sm font-medium text-zinc-900",children:["我的篇章",(0,l.jsxs)("span",{className:"ml-2 text-xs font-medium text-zinc-400",children:["(",t.length,")"]})]}),"drawer"===g&&(0,l.jsx)("button",{type:"button",className:"rounded-md p-2 text-zinc-400 transition-colors hover:bg-zinc-100 hover:text-zinc-700",onClick:()=>null==f?void 0:f(!1),"aria-label":"关闭",children:(0,l.jsx)(E.Z,{className:"h-4 w-4"})})]}),(0,l.jsxs)("div",{className:"flex min-h-0 flex-1 flex-col gap-2 overflow-y-auto rounded-xl border border-zinc-200/60 bg-white p-2 custom-scrollbar",children:[p.map(e=>{var t;let a=e.id===n,o=null!==(t=W[e.color||A])&&void 0!==t?t:W[A],c=function(e,t){let n=(0,s.b)((0,x.D)(e.startISO)),l=(0,s.b)((0,x.D)(e.endISO)),a=(0,s.b)(t),r=(0,M.w)(l,n)+1,o=function(e,t){let n=(0,s.b)((0,x.D)(e.startISO)),l=(0,s.b)((0,x.D)(e.endISO)),a=(0,s.b)(t);return(0,j.R)(a,n)?"upcoming":(0,i.A)(a,l)?"ended":"active"}(e,t);if("upcoming"===o)return{status:o,totalDays:r,label:"未开始",detail:"还有 ".concat(Math.max(0,(0,M.w)(n,a))," 天")};if("ended"===o)return{status:o,totalDays:r,label:"已结束",detail:"已完成"};let c=Math.max(0,Math.min(r,(0,M.w)(a,n)));return{status:o,totalDays:r,label:"进行中",detail:"剩余 ".concat(Math.max(0,r-c)," 天")}}(e,h),b=function(e,t){try{let n=(0,s.b)((0,x.D)(e.startISO)),l=(0,s.b)((0,x.D)(e.endISO));if(Number.isNaN(n.getTime())||Number.isNaN(l.getTime()))return 0;let a=(0,s.b)(t);if((0,i.A)(a,l))return 100;if((0,j.R)(a,n))return 0;let r=(0,w.c)((0,y.i)(l),n);if(r<=0)return 100;let o=(0,w.c)(t,n);return Math.min(100,Math.max(0,o/r*100))}catch(e){return 0}}(e,h),p="active"===c.status?(0,l.jsx)("span",{className:"rounded-full px-2 py-0.5 text-[10px] font-medium ".concat(o.progressTag),children:c.label}):"upcoming"===c.status?(0,l.jsx)("span",{className:"rounded-full bg-blue-50 px-2 py-0.5 text-[10px] font-medium text-blue-600",children:c.label}):(0,l.jsx)("span",{className:"rounded-full bg-zinc-100 px-2 py-0.5 text-[10px] font-medium text-zinc-500",children:c.label});return(0,l.jsxs)("div",{className:"group relative flex items-start justify-between rounded-lg px-2 py-2 text-sm transition-colors ".concat(a?"bg-emerald-50 text-emerald-900":"hover:bg-zinc-50 text-zinc-700"),children:[(0,l.jsx)("button",{className:"flex-1 text-left pr-8",onClick:()=>{r(e.id),"drawer"===g&&(null==f||f(!1))},children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"h-2 w-2 rounded-full ".concat(o.dotBg)}),(0,l.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("div",{className:"truncate font-medium",children:e.name}),p]}),(0,l.jsxs)("div",{className:"mt-0.5 flex items-center justify-between text-[10px] ".concat(a?"text-emerald-600/80":"text-zinc-400"),children:[(0,l.jsxs)("span",{className:"truncate",children:[U(e.startISO)," - ",U(e.endISO)]}),(0,l.jsx)("span",{className:"ml-2 shrink-0 tabular-nums",children:c.detail})]}),(0,l.jsx)("div",{className:"mt-1 h-1.5 w-full overflow-hidden rounded-full bg-zinc-200/70",children:(0,l.jsx)("div",{className:"h-full bg-gradient-to-r ".concat(o.progressBarFrom," ").concat(o.progressBarTo),style:{width:"".concat(b,"%")}})})]})]})}),a&&(0,l.jsx)(R.Z,{className:"absolute right-2 top-1/2 -translate-y-1/2 h-4 w-4 text-emerald-600"}),(0,l.jsxs)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 hidden group-hover:flex items-center gap-1 bg-white/80 backdrop-blur-sm rounded-md pl-1 shadow-sm border border-zinc-100",children:[(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),d(e),"drawer"===g&&(null==f||f(!1))},className:"p-1 hover:bg-zinc-100 rounded text-zinc-500 hover:text-zinc-900",title:"编辑",children:(0,l.jsx)(T.Z,{className:"h-3 w-3"})}),(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),m(e.id)},className:"p-1 hover:bg-zinc-100 rounded text-zinc-500 hover:text-zinc-900",title:"复制",children:(0,l.jsx)(F.Z,{className:"h-3 w-3"})}),(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),u(e.id)},className:"p-1 hover:bg-rose-50 rounded text-zinc-400 hover:text-rose-600",title:"删除",children:(0,l.jsx)(_.Z,{className:"h-3 w-3"})})]})]},e.id)}),0===p.length&&(0,l.jsx)("div",{className:"px-2 py-4 text-center text-xs text-zinc-400",children:"暂无区间，开始创建吧"})]}),c&&(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200/60 bg-white p-2",children:[(0,l.jsx)("div",{className:"px-1 pb-2 text-[11px] font-medium text-zinc-400",children:"推荐模板"}),(0,l.jsxs)("div",{className:"grid gap-1",children:[(0,l.jsxs)("button",{type:"button",onClick:()=>{c("sprint_2w"),"drawer"===g&&(null==f||f(!1))},className:"flex items-center justify-between rounded-lg border border-zinc-200/60 bg-white px-3 py-2 text-left text-xs font-medium text-zinc-700 transition-colors hover:bg-zinc-50",children:[(0,l.jsx)("span",{children:"\uD83C\uDFC3‍♂️ 短期冲刺"}),(0,l.jsx)("span",{className:"text-[11px] font-medium text-zinc-400",children:"2周"})]}),(0,l.jsxs)("button",{type:"button",onClick:()=>{c("quarter_3m"),"drawer"===g&&(null==f||f(!1))},className:"flex items-center justify-between rounded-lg border border-zinc-200/60 bg-white px-3 py-2 text-left text-xs font-medium text-zinc-700 transition-colors hover:bg-zinc-50",children:[(0,l.jsx)("span",{children:"\uD83C\uDFAF 季度目标"}),(0,l.jsx)("span",{className:"text-[11px] font-medium text-zinc-400",children:"3个月"})]}),(0,l.jsxs)("button",{type:"button",onClick:()=>{c("travel"),"drawer"===g&&(null==f||f(!1))},className:"flex items-center justify-between rounded-lg border border-zinc-200/60 bg-white px-3 py-2 text-left text-xs font-medium text-zinc-700 transition-colors hover:bg-zinc-50",children:[(0,l.jsx)("span",{children:"✈️ 旅行倒数"}),(0,l.jsx)("span",{className:"text-[11px] font-medium text-zinc-400",children:"自定义"})]})]})]}),(0,l.jsxs)("button",{onClick:()=>{o(),"drawer"===g&&(null==f||f(!1))},className:"flex w-full items-center justify-center gap-2 rounded-lg bg-zinc-900 py-2 text-sm font-medium text-white transition-colors hover:bg-zinc-800",type:"button",children:[(0,l.jsx)(B.Z,{className:"h-4 w-4"}),"新建篇章"]})]});return"sidebar"===g?(0,l.jsx)("div",{className:"h-full",children:v}):b?(0,l.jsxs)("div",{className:"fixed inset-0 z-50 lg:hidden",role:"dialog","aria-modal":"true",children:[(0,l.jsx)("button",{type:"button",className:"absolute inset-0 bg-black/40",onClick:()=>null==f?void 0:f(!1),"aria-label":"关闭"}),(0,l.jsx)("div",{className:"absolute inset-y-0 right-0 w-[320px] max-w-[90vw] bg-white shadow-2xl p-4",children:v})]}):null}var L=(0,a.memo)(function(e){var t;let{day:n,variant:a="compact",onHover:r,onMove:s,onLeave:i,onClick:o,onMouseDown:c,onMouseUp:d,onFocus:u,onBlur:m,onKeyDown:x,dimmed:h,selected:g,isDragSelected:b,forceGray:f,themeColor:p="emerald",entry:v,tabIndex:y,dataIso:w,showWeekend:j=!1,showHoliday:N=!1,showDateNumber:S=!1,dimDateNumber:D=!1}=e,k=W[p]||W.emerald,M="large"===a?"relative aspect-square w-full cursor-pointer rounded-2xl shadow-sm transition-all duration-150 ease-out will-change-transform hover:z-10 hover:shadow-md hover:brightness-[1.01] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-0":"mini"===a?"relative aspect-square w-full cursor-pointer rounded-md transition-all duration-150 ease-out will-change-transform hover:z-10 hover:scale-110 hover:shadow-md focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-0":"relative aspect-square w-full cursor-pointer rounded-lg transition-all duration-150 ease-out will-change-transform hover:z-10 hover:shadow-md hover:brightness-[1.01] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-0",I=n.date.getDate(),O="today"===n.state,E=!!n.holiday&&N,R=S&&("mini"===a||"compact"===a),T=null!==(t=null==v?void 0:v.state)&&void 0!==t?t:0,F=z[T].dotClass,_=O?"ring-2 ".concat(k.dayRing," ring-offset-2 ring-offset-white ").concat(k.dayShadow," shadow-lg"):"",B="past"===n.state?"bg-[#888888] text-white":b?k.dayMarked:O?k.dayToday:f?"bg-zinc-200/70 text-zinc-700":v?k.dayMarked:n.holiday&&N?"bg-[#FFB4AD] text-zinc-900":n.isWeekend&&j?"bg-[#D2D5F2] text-zinc-900":k.dayFuture,A="large"===a?(0,l.jsxs)("div",{className:"pointer-events-none absolute inset-0 flex flex-col items-center justify-center gap-0.5 px-1",children:[(0,l.jsx)("div",{className:"select-none text-lg font-semibold leading-none tabular-nums ".concat(O?"text-white":"text-zinc-900"," ").concat(D?"opacity-30":""),children:I}),E?(0,l.jsx)("div",{className:"select-none text-[12px] font-semibold leading-none tracking-tight ".concat(O?"text-white/90":"text-zinc-600"),children:n.holiday}):null]}):R||E?(0,l.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center px-0.5",children:(0,l.jsxs)("div",{className:"flex max-w-full flex-col items-center justify-center gap-0.5",children:[R?(0,l.jsx)("div",{className:"select-none font-semibold leading-none tabular-nums ".concat("mini"===a?"text-[10px]":"text-[13px]"," ").concat(D?"opacity-30":""),children:I}):null,E?(0,l.jsx)("div",{className:"select-none font-semibold leading-none tracking-tight ".concat("mini"===a?"text-[8px]":"text-[10px]"," truncate"),children:n.holiday}):null]})}):null,U=0!==T?(0,l.jsx)("div",{className:"pointer-events-none absolute right-1 top-1",children:(0,l.jsx)("span",{className:"block rounded-full ".concat("mini"===a?"bg-[#009C7B] ring-1 ring-white":F," ").concat("mini"===a?"h-1.5 w-1.5":"h-2 w-2")})}):null,H=g?"ring-2 ".concat(k.dayRing," ring-offset-2 ring-offset-white"):"",L=h?"opacity-40":"";return"today"===n.state?(0,l.jsxs)(C.E.div,{role:"gridcell","aria-label":n.label,"data-iso":null!=w?w:n.isoDate,tabIndex:y,className:"".concat(M," ").concat(k.dayFocusOutline," ").concat(B," ").concat(_," ").concat(H," ").concat(L),onMouseEnter:e=>r(n,e),onMouseMove:e=>s(n,e),onMouseLeave:i,onFocus:e=>null==u?void 0:u(n,e),onBlur:e=>null==m?void 0:m(n,e),onKeyDown:e=>null==x?void 0:x(n,e),onClick:e=>null==o?void 0:o(n,e),onMouseDown:e=>null==c?void 0:c(n,e),onMouseUp:e=>null==d?void 0:d(n,e),children:[A,U]}):(0,l.jsxs)("div",{role:"gridcell","aria-label":n.label,"data-iso":null!=w?w:n.isoDate,tabIndex:y,className:"".concat(M," ").concat(k.dayFocusOutline," ").concat(B," ").concat(_," ").concat(H," ").concat(L),onMouseEnter:e=>r(n,e),onMouseMove:e=>s(n,e),onMouseLeave:i,onFocus:e=>null==u?void 0:u(n,e),onBlur:e=>null==m?void 0:m(n,e),onKeyDown:e=>null==x?void 0:x(n,e),onClick:e=>null==o?void 0:o(n,e),onMouseDown:e=>null==c?void 0:c(n,e),onMouseUp:e=>null==d?void 0:d(n,e),children:[A,U]})});let Z=e=>{let{viewMode:t,days:n,columns:r,gridGap:s,entries:i,selectedISODate:o,focusedISODate:c,highlightWeekends:d,highlightHolidays:u,effectiveHighlightThisMonth:m,currentMonth:x,recordFilter:h,noteOnly:g,stateFilters:b,noteQuery:f,isDragging:p,dragStartISO:v,dragCurrentISO:y,isRangeEditing:w,rangeDraftColor:j,rangeDraftStartISO:N,rangeDraftEndISO:S,onCellHover:z,onCellMove:D,onCellLeave:k,onCellFocus:M,onCellBlur:I,onCellKeyDown:O,onCellClick:C,onCellMouseDown:E,onCellMouseUp:R}=e,[T,F]=(0,a.useState)(null),_=(0,a.useMemo)(()=>{if("year"!==t)return[];let e=new Map;for(let t of n){let n=e.get(t.month);n?n.push(t):e.set(t.month,[t])}let l=[];for(let t=1;t<=12;t+=1){var a;let n=null!==(a=e.get(t))&&void 0!==a?a:[];if(0===n.length)continue;let r=(n[0].date.getDay()+6)%7;l.push({month:t,offset:r,days:n})}return l},[n,t]),B=function(e){var n;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"compact",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=null!==(n=i[e.isoDate])&&void 0!==n?n:null,T=o===e.isoDate,F=!m||m&&e.month===x,_=!!s,B=!!(null==s?void 0:s.note.trim()),W=0===b.length||!!s&&b.includes(s.state),A=f.trim().toLowerCase(),U=!A||B&&s.note.toLowerCase().includes(A),H=m||"all"!==h||g||b.length>0||""!==A,Z=!1;p&&v&&y?Z=e.isoDate>=(v<y?v:y)&&e.isoDate<=(v>y?v:y):w&&N&&S&&(Z=e.isoDate>=N&&e.isoDate<=S);let P=w&&Z?j:"emerald";return(0,l.jsx)(L,{variant:a,dataIso:e.isoDate,tabIndex:c===e.isoDate?0:-1,day:e,dimmed:"range"!==t&&H&&!(F&&("all"===h||("recorded"===h?_:!_))&&(!g||B)&&W&&U),selected:T,isDragSelected:Z,forceGray:w&&!Z,themeColor:P,entry:w?null:s,showWeekend:d,showHoliday:u,showDateNumber:"mini"===a||"month"===t||r,dimDateNumber:("mini"===a||"month"===t)&&!r,onHover:z,onMove:D,onLeave:k,onFocus:M,onBlur:I,onKeyDown:O,onClick:C,onMouseDown:E,onMouseUp:R},e.isoDate)};if("month"===t){if(0===n.length)return null;let e=(n[0].date.getDay()+6)%7,t=e+n.length;return(0,l.jsxs)("div",{className:"grid gap-2",style:{gridTemplateColumns:"repeat(7, 1fr)"},children:[["一","二","三","四","五","六","日"].map(e=>(0,l.jsx)("div",{className:"mb-1 text-center text-xs font-medium text-zinc-400",children:e},e)),Array.from({length:e}).map((e,t)=>(0,l.jsx)("div",{},"offset-".concat(t))),n.map(e=>B(e,"compact",!0)),Array.from({length:t%7==0?0:7-t%7}).map((e,t)=>(0,l.jsx)("div",{},"trailing-".concat(t)))]})}return"year"===t?(0,l.jsx)("div",{className:"grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:_.map(e=>{let t=e.month===x,n=T===e.month,a=t||n;return(0,l.jsxs)("div",{className:"flex flex-col rounded-2xl transition-all duration-300 ease-out ".concat(a?"bg-zinc-50":""," ").concat(t?"sm:col-span-2 sm:row-span-2 p-6 shadow-sm ring-1 ring-zinc-200/50":"p-3"),onMouseEnter:()=>F(e.month),onMouseLeave:()=>F(null),children:[(0,l.jsxs)("div",{className:"mb-3 flex items-baseline justify-between",children:[(0,l.jsxs)("span",{className:"".concat(t?"text-xl":"text-sm"," font-semibold text-zinc-900"),children:[e.month,"月"]}),(0,l.jsxs)("span",{className:"".concat(t?"text-xs":"text-[10px]"," text-zinc-400"),children:[e.days.length,"天"]})]}),(0,l.jsxs)("div",{className:"grid ".concat(t?"gap-2":"gap-1.5"),style:{gridTemplateColumns:"repeat(7, 1fr)"},children:[["一","二","三","四","五","六","日"].map(e=>(0,l.jsx)("div",{className:"mb-1 text-center font-medium text-zinc-400 ".concat(t?"text-xs":"text-[10px]"),children:e},e)),Array.from({length:e.offset}).map((e,t)=>(0,l.jsx)("div",{},"offset-".concat(t))),e.days.map(e=>B(e,t?"compact":"mini",a))]})]},e.month)})}):(0,l.jsx)("div",{className:"grid",style:{gridTemplateColumns:"repeat(".concat(r,", 1fr)"),gap:"".concat(s,"px")},children:n.map(e=>B(e,"compact",!0))})};function P(e,t){let n=e.trim()||"区间",l=new Set(t.map(e=>e.name.trim()));if(!l.has(n))return n;let a=2;for(;l.has("".concat(n,"-").concat(a));)a+=1;return"".concat(n,"-").concat(a)}function q(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}function K(e){if(!e||"object"!=typeof e)return null;let t={};for(let[n,l]of Object.entries(e)){if(!function(e){if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;try{return(0,r.WU)((0,x.D)(e),"yyyy-MM-dd")===e}catch(e){return!1}}(n)||!l||"object"!=typeof l)continue;let e=l.state,a=l.note;if(!(0===e||1===e||2===e||3===e||4===e||5===e))continue;let s="string"==typeof a?a.slice(0,50):"";(0!==e||""!==s.trim())&&(t[n]={state:e,note:s})}return t}function G(e){if(!Array.isArray(e))return null;let t=[];for(let l of e){var n;if(!l||"object"!=typeof l)continue;let e=l.id,a=l.name,r=l.startISO,o=l.endISO,c=l.color,d=l.entries;if("string"!=typeof e||"string"!=typeof r||"string"!=typeof o)continue;let u="string"==typeof a?a.trim():"";try{let e=(0,s.b)((0,x.D)(r)),t=(0,s.b)((0,x.D)(o));if((0,i.A)(e,t))continue}catch(e){continue}let m="emerald"===c||"blue"===c||"rose"===c||"amber"===c||"violet"===c||"zinc"===c?c:void 0,h=null!==(n=K(d))&&void 0!==n?n:void 0;t.push({id:e,name:u||"区间",startISO:r,endISO:o,...m?{color:m}:{},...h?{entries:h}:{}})}if(0===t.length)return[];let l=new Set,a=new Set,r=[];for(let e of t){let t=e.id.trim()||"range_".concat(Date.now()),n=t;for(;l.has(n);)n="".concat(t,"_").concat(Math.floor(1e5*Math.random()));l.add(n);let s=e.name.trim()||"区间",i=s;if(a.has(i)){let e=2;for(;a.has("".concat(s,"-").concat(e));)e+=1;i="".concat(s,"-").concat(e)}a.add(i),r.push({...e,id:n,name:i})}return r}function V(e){if(!e||"object"!=typeof e)return null;let t=e.mode,n=e.anchorISO,l=e.customStartISO,a=e.customEndISO,r=e.activeRangeId,s={mode:"year"===t||"month"===t||"week"===t||"range"===t?t:null,anchorISO:"string"==typeof n?n:null,customStartISO:"string"==typeof l?l:null,customEndISO:"string"==typeof a?a:null,activeRangeId:"string"==typeof r?r:null};return s.mode||s.anchorISO||s.customStartISO||s.customEndISO||s.activeRangeId?s:null}var J=n(415),Y=n(740),Q=n(2451),X=n(407),$=n(6443),ee=n(2735),et=n(7689);function en(e){let{viewMode:t,setViewMode:n,anchorISO:a,setAnchorISO:s,rangeStart:i,rangeEnd:o,now:c,showFilters:u,setShowFilters:m,highlightWeekends:h,setHighlightWeekends:g,highlightHolidays:b,setHighlightHolidays:f,highlightThisMonth:p,setHighlightThisMonth:v,noteOnly:y,setNoteOnly:w,recordFilter:j,setRecordFilter:N,ranges:S,activeRangeId:D,setActiveRangeId:k,activeRange:M,isEditingRange:I,setIsEditingRange:O,isRangeEditing:C,rangeDraftName:F,setRangeDraftName:B,rangeDraftColor:W,setRangeDraftColor:A,rangeDraftStartISO:U,setRangeDraftStartISO:H,rangeDraftEndISO:L,setRangeDraftEndISO:Z,rangeDraftValid:P,rangeDraftSaving:q,setRangeDraftSaving:K,setTooltip:G,setSelectedISODate:V,deleteActiveRange:en,applyRangeDraftToActive:el,cancelCreateRange:ea,customStartISO:er,setCustomStartISO:es,customEndISO:ei,setCustomEndISO:eo,stateFilters:ec,toggleStateFilter:ed,noteQuery:eu,setNoteQuery:em,clearFilters:ex,exportData:eh,triggerImport:eg,openRangeNav:eb}=e;return(0,l.jsxs)("div",{className:"flex flex-col items-end gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("div",{className:"flex items-center rounded-lg border border-zinc-200/60 bg-zinc-100/60 p-1 shadow-sm",children:["year","month","week","range"].map(e=>(0,l.jsx)("button",{type:"button",className:"rounded-md px-4 py-2 text-sm font-medium transition-all ".concat(t===e?"bg-emerald-600 text-white shadow-sm":"text-zinc-500 hover:bg-zinc-100/80 hover:text-zinc-900"),onClick:()=>{if(G(null),V(null),n(e),("month"===e||"week"===e||"year"===e)&&s((0,r.WU)(c,"yyyy-MM-dd")),"range"===e){var t,l,a;let e=null!==(t=null==M?void 0:M.startISO)&&void 0!==t?t:er,n=null!==(l=null==M?void 0:M.endISO)&&void 0!==l?l:ei;H(e),Z(n),B(null!==(a=null==M?void 0:M.name)&&void 0!==a?a:""),O(!1)}"year"!==e&&v(!1)},children:"year"===e?"年":"month"===e?"月":"week"===e?"周":"区间"},e))}),(0,l.jsx)("button",{type:"button",onClick:()=>m(!u),className:"rounded-lg border p-2.5 transition-all ".concat(u?"border-emerald-600 bg-emerald-600 text-white shadow-md":"border-zinc-200/60 bg-white text-zinc-500 shadow-sm hover:border-emerald-600/50 hover:text-zinc-900"),children:(0,l.jsx)(Y.Z,{className:"h-4 w-4"})})]}),(0,l.jsxs)("div",{className:"flex items-center justify-end gap-4",children:["year"===t&&(0,l.jsx)("div",{className:"flex h-10 items-center rounded-lg border border-zinc-200/60 bg-white px-4 text-sm font-medium text-zinc-900 shadow-sm",children:(0,r.WU)(i,"yyyy年")}),("month"===t||"week"===t)&&(0,l.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border border-zinc-200/60 bg-zinc-100/60 p-1 shadow-sm",children:[(0,l.jsx)("button",{type:"button",className:"rounded-md p-2 text-zinc-500 transition-colors hover:bg-white hover:text-zinc-900",onClick:()=>{let e="month"===t?(0,d.z)((0,x.D)(a),-1):(0,J.j)((0,x.D)(a),-1);s((0,r.WU)(e,"yyyy-MM-dd"))},children:(0,l.jsx)(Q.Z,{className:"h-4 w-4"})}),(0,l.jsx)("span",{className:"min-w-[132px] px-1 text-center text-sm font-medium tabular-nums text-zinc-900",children:"month"===t?(0,r.WU)(i,"yyyy年MM月"):"".concat((0,r.WU)(i,"MM.dd")," - ").concat((0,r.WU)(o,"MM.dd"))}),(0,l.jsx)("button",{type:"button",className:"rounded-md p-2 text-zinc-500 transition-colors hover:bg-white hover:text-zinc-900",onClick:()=>{let e="month"===t?(0,d.z)((0,x.D)(a),1):(0,J.j)((0,x.D)(a),1);s((0,r.WU)(e,"yyyy-MM-dd"))},children:(0,l.jsx)(X.Z,{className:"h-4 w-4"})}),(0,l.jsx)("div",{className:"mx-1 h-5 w-px bg-zinc-200"}),(0,l.jsx)("button",{type:"button",className:"rounded-md px-3 py-2 text-sm text-zinc-600 transition-colors hover:bg-white hover:text-zinc-900",onClick:()=>s((0,r.WU)(c,"yyyy-MM-dd")),children:"回到当前"})]}),"range"===t&&(S.length>0||I)&&(0,l.jsxs)("div",{className:"relative flex flex-col items-end gap-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("button",{type:"button",onClick:()=>null==eb?void 0:eb(),className:"flex items-center gap-2 rounded-lg border border-zinc-200/60 bg-white pl-4 pr-3 py-2 text-sm font-medium text-zinc-900 shadow-sm transition-all hover:bg-zinc-50 active:scale-[0.98] lg:hidden",children:[(0,l.jsx)("span",{className:"truncate max-w-[120px]",children:"我的篇章"}),(0,l.jsx)(X.Z,{className:"h-4 w-4 text-zinc-400 rotate-90"})]}),(0,l.jsxs)("button",{type:"button",disabled:!D||I,className:"flex items-center gap-2 rounded-lg border border-zinc-200/60 bg-white px-3 py-2 text-sm font-medium text-zinc-700 shadow-sm transition-all hover:bg-zinc-50 hover:text-zinc-900 disabled:bg-zinc-50 disabled:text-zinc-400",onClick:()=>{if(!D)return;let e=S.find(e=>e.id===D);e&&(k(e.id),B(e.name),H(e.startISO),Z(e.endISO),A(e.color||"emerald"),O(!0),K(!1))},title:"编辑",children:[(0,l.jsx)(T.Z,{className:"h-4 w-4"}),"编辑"]})]}),I&&(0,l.jsxs)("div",{className:"absolute top-full right-0 z-30 mt-2 flex w-[600px] max-w-[90vw] flex-col gap-4 rounded-xl border border-zinc-200/60 bg-white p-4 shadow-xl animate-in fade-in slide-in-from-top-2 duration-200",children:[(0,l.jsx)("div",{className:"flex flex-wrap items-center gap-3",children:(0,l.jsx)("input",{type:"text",className:"h-10 flex-1 rounded-lg border border-zinc-200 bg-white px-3 text-sm text-zinc-900 outline-none transition focus:border-emerald-600/40 focus:ring-2 focus:ring-emerald-600/15",placeholder:"名称",value:F,onChange:e=>B(e.target.value)})}),(0,l.jsxs)("div",{className:"flex items-center gap-3 px-1",children:[(0,l.jsx)("span",{className:"text-sm font-medium text-zinc-500",children:"主题色"}),(0,l.jsx)("div",{className:"flex items-center gap-2",children:["emerald","blue","rose","amber","violet","cyan"].map(e=>(0,l.jsx)("button",{type:"button",onClick:()=>A(e),className:"h-6 w-6 rounded-full border border-white shadow-sm ring-1 ring-inset transition-transform ".concat(W===e?"ring-zinc-900 scale-110":"ring-zinc-200 hover:scale-105"," ").concat("emerald"===e?"bg-emerald-500":"blue"===e?"bg-blue-500":"rose"===e?"bg-rose-500":"amber"===e?"bg-amber-500":"violet"===e?"bg-violet-500":"bg-cyan-500")},e))})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("div",{className:"flex flex-1 items-center gap-2 rounded-lg border border-zinc-200 bg-zinc-50/50 p-1",children:[(0,l.jsx)("input",{type:"date",className:"h-9 w-full min-w-0 bg-transparent px-2 text-sm text-zinc-900 outline-none",value:U,onChange:e=>{let t=e.target.value;H(t),null===D&&C&&t&&((!er||t<er)&&es(t),L&&(!ei||L>ei)&&eo(L))}}),(0,l.jsx)("span",{className:"text-zinc-400",children:"-"}),(0,l.jsx)("input",{type:"date",className:"h-9 w-full min-w-0 bg-transparent px-2 text-sm text-zinc-900 outline-none",value:L,onChange:e=>{let t=e.target.value;Z(t),null===D&&C&&t&&((!ei||t>ei)&&eo(t),U&&(!er||U<er)&&es(U))}})]}),(0,l.jsxs)("button",{type:"button",disabled:!P||q,className:"flex h-11 items-center gap-2 rounded-lg bg-emerald-600 px-6 text-sm font-medium text-white shadow-sm transition-colors hover:bg-emerald-700 disabled:bg-zinc-100 disabled:text-zinc-400",onClick:()=>{q||(K(!0),el(),O(!1))},title:"保存",children:[(0,l.jsx)(R.Z,{className:"h-4 w-4"}),"保存"]}),null===D&&(0,l.jsxs)("button",{type:"button",disabled:q,className:"flex h-11 items-center gap-2 rounded-lg border border-zinc-200 bg-white px-4 text-sm font-medium text-zinc-600 transition-colors hover:bg-zinc-50 hover:text-zinc-900 disabled:opacity-40",onClick:ea,title:"取消创建",children:[(0,l.jsx)(E.Z,{className:"h-4 w-4"}),"取消"]}),(0,l.jsx)("button",{type:"button",disabled:!D||S.length<=1,className:"flex h-11 w-11 items-center justify-center rounded-lg border border-zinc-200 bg-white text-zinc-600 transition-colors hover:bg-zinc-50 hover:text-zinc-900 disabled:opacity-40",onClick:en,title:S.length<=1?"至少保留一个区间":"删除",children:(0,l.jsx)(_.Z,{className:"h-4 w-4"})})]}),null===D&&""===U&&""===L&&(0,l.jsx)("div",{className:"rounded-lg border border-amber-200 bg-amber-50 px-3 py-2",children:(0,l.jsxs)("div",{className:"flex items-start gap-2",children:[(0,l.jsx)($.Z,{className:"mt-0.5 h-4 w-4 text-amber-700"}),(0,l.jsxs)("div",{className:"min-w-0",children:[(0,l.jsx)("div",{className:"text-xs font-medium text-amber-900",children:"拖拽选择时间"}),(0,l.jsx)("div",{className:"mt-0.5 text-[11px] leading-4 text-amber-900/80",children:"在日历上按住鼠标拖拽，可自动填入开始/结束日期。"})]})]})})]})]})]}),u&&(0,l.jsxs)("div",{className:"mb-6 mt-6 rounded-xl border border-zinc-200/60 bg-white p-4 shadow-sm animate-in fade-in slide-in-from-top-2 duration-200",children:[(0,l.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-sm font-medium text-zinc-900",children:"筛选选项"}),(0,l.jsx)("button",{type:"button",className:"text-zinc-400 transition-colors hover:text-zinc-700",onClick:()=>m(!1),"aria-label":"关闭筛选",children:(0,l.jsx)(E.Z,{className:"h-5 w-5"})})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-6",children:[(0,l.jsxs)("label",{className:"group flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:h,onChange:e=>g(e.target.checked),className:"h-4 w-4 cursor-pointer rounded border-zinc-300 bg-white accent-emerald-600"}),(0,l.jsx)("span",{className:"cursor-pointer text-sm text-zinc-900 transition-colors group-hover:text-emerald-700",children:"显示周末"})]}),(0,l.jsxs)("label",{className:"group flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:b,onChange:e=>f(e.target.checked),className:"h-4 w-4 cursor-pointer rounded border-zinc-300 bg-white accent-emerald-600"}),(0,l.jsx)("span",{className:"cursor-pointer text-sm text-zinc-900 transition-colors group-hover:text-emerald-700",children:"显示节假日"})]}),"year"===t&&(0,l.jsxs)("label",{className:"group flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:p,onChange:e=>v(e.target.checked),className:"h-4 w-4 cursor-pointer rounded border-zinc-300 bg-white accent-emerald-600"}),(0,l.jsx)("span",{className:"cursor-pointer text-sm text-zinc-900 transition-colors group-hover:text-emerald-700",children:"高亮本月"})]}),(0,l.jsxs)("label",{className:"group flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:y,onChange:e=>w(e.target.checked),className:"h-4 w-4 cursor-pointer rounded border-zinc-300 bg-white accent-emerald-600"}),(0,l.jsx)("span",{className:"cursor-pointer text-sm text-zinc-900 transition-colors group-hover:text-emerald-700",children:"仅有备注"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-sm text-zinc-500",children:"记录:"}),(0,l.jsxs)("select",{value:j,onChange:e=>N(e.target.value),className:"rounded-lg border border-zinc-200 bg-white px-3 py-1.5 text-sm text-zinc-900 outline-none transition focus:border-emerald-600/40 focus:ring-2 focus:ring-emerald-600/15",children:[(0,l.jsx)("option",{value:"all",children:"全部"}),(0,l.jsx)("option",{value:"recorded",children:"已记录"}),(0,l.jsx)("option",{value:"unrecorded",children:"未记录"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-sm text-zinc-500",children:"体感:"}),(0,l.jsx)("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(e=>{let t=ec.includes(e);return(0,l.jsx)("button",{type:"button","aria-pressed":t,className:"flex h-8 w-8 items-center justify-center rounded-lg border text-sm transition-colors ".concat(t?"border-emerald-600 bg-emerald-600 text-white":"border-zinc-200 bg-white text-zinc-600 hover:bg-zinc-50 hover:text-zinc-900"),onClick:()=>ed(e),title:z[e].label,children:z[e].emoji},e)})})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-sm text-zinc-500",children:"备注:"}),(0,l.jsx)("input",{type:"text",className:"w-[18ch] rounded-lg border border-zinc-200 bg-white px-3 py-1.5 text-sm text-zinc-900 outline-none transition focus:border-emerald-600/40 focus:ring-2 focus:ring-emerald-600/15",placeholder:"搜备注",value:eu,onChange:e=>em(e.target.value)})]}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,l.jsx)("button",{type:"button",className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-sm text-zinc-600 transition-colors hover:bg-zinc-50 hover:text-zinc-900",onClick:ex,children:"清除"}),(0,l.jsxs)("button",{type:"button",className:"flex items-center gap-2 rounded-lg border border-zinc-200 bg-white px-3 py-2 text-sm text-zinc-600 transition-colors hover:bg-zinc-50 hover:text-zinc-900",onClick:eh,children:[(0,l.jsx)(ee.Z,{className:"h-4 w-4"}),"导出"]}),(0,l.jsxs)("button",{type:"button",className:"flex items-center gap-2 rounded-lg border border-zinc-200 bg-white px-3 py-2 text-sm text-zinc-600 transition-colors hover:bg-zinc-50 hover:text-zinc-900",onClick:eg,children:[(0,l.jsx)(et.Z,{className:"h-4 w-4"}),"导入"]})]})]})]})]})}function el(e){let{visible:t,onDismiss:n}=e;return t?(0,l.jsx)("div",{className:"absolute left-1/2 top-full z-40 mt-2 w-full max-w-[320px] -translate-x-1/2 rounded-xl border border-zinc-200 bg-white p-3 shadow-xl md:max-w-[400px]",children:(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs font-medium text-zinc-900",children:"点击格子记录体感（1–5）"}),(0,l.jsx)("div",{className:"mt-1 text-[10px] text-zinc-500",children:"支持添加备注，或使用过滤功能快速查看特定日期"})]}),(0,l.jsx)("button",{type:"button",className:"text-zinc-400 hover:text-zinc-600",onClick:n,children:(0,l.jsx)(E.Z,{className:"h-3.5 w-3.5"})})]})}):null}function ea(e){let{onStartNewRange:t}=e;return(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center rounded-2xl border border-dashed border-zinc-200 bg-zinc-50/50 py-24 text-center",children:[(0,l.jsx)("div",{className:"mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-emerald-50 text-emerald-600",children:(0,l.jsx)(B.Z,{className:"h-8 w-8"})}),(0,l.jsx)("h3",{className:"mb-2 text-lg font-medium text-zinc-900",children:"开始你的第一个区间"}),(0,l.jsx)("p",{className:"mb-6 max-w-sm text-sm text-zinc-500",children:"区间可以是一段旅行、一个项目周期、或者任何你想特别标记的时间段。"}),(0,l.jsxs)("button",{type:"button",onClick:t,className:"inline-flex items-center gap-2 rounded-lg bg-emerald-500 px-5 py-2.5 text-sm font-medium text-white shadow-sm transition-all hover:bg-emerald-600 hover:shadow-md active:scale-[0.98]",children:[(0,l.jsx)(B.Z,{className:"h-4 w-4"}),"创建新区间"]})]})}let er=[{label:"已过",color:"#D8E9E4",border:!1,type:"static"},{label:"今天",color:"#009C7B",border:!1,type:"static"},{label:"未来",color:"#EEF3F4",border:!0,type:"static"},{label:"周末",color:"#D2D5F2",border:!1,type:"toggle",key:"weekend"},{label:"节假日",color:"#FFB4AD",border:!1,type:"toggle",key:"holiday"},{label:"已标记",color:"#7BC27E",border:!1,type:"static"}];function es(e){let{showWeekends:t=!1,onToggleWeekends:n,showHolidays:a=!1,onToggleHolidays:r}=e;return(0,l.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-x-2 gap-y-2 text-sm",children:[(0,l.jsx)("span",{className:"text-xs font-medium text-zinc-500 mr-2",children:"图例:"}),er.map(e=>{if("toggle"===e.type){let s="weekend"===e.key?t:a,i="weekend"===e.key?n:r;return(0,l.jsxs)("button",{type:"button",onClick:i,disabled:!i,"aria-pressed":s,className:"flex items-center gap-2 rounded-md px-2 py-1 transition-all ".concat(s?"bg-zinc-100 ring-1 ring-zinc-200 shadow-sm":"hover:bg-zinc-50 opacity-60 grayscale"," ").concat(i?"":"cursor-not-allowed opacity-40 grayscale-0"),children:[(0,l.jsx)("div",{className:"h-3.5 w-3.5 rounded ".concat(e.border?"border border-zinc-200":""),style:{backgroundColor:e.color}}),(0,l.jsx)("span",{className:"text-xs ".concat(s?"text-zinc-900 font-medium":"text-zinc-500"),children:e.label})]},e.label)}return(0,l.jsxs)("div",{className:"flex items-center gap-2 px-2 py-1",children:[(0,l.jsx)("div",{className:"h-3.5 w-3.5 rounded ".concat(e.border?"border border-zinc-200":""),style:{backgroundColor:e.color}}),(0,l.jsx)("span",{className:"text-xs text-zinc-500",children:e.label})]},e.label)})]})}function ei(e){let{range:t,now:n}=e,o=W[t.color||"emerald"]||W.emerald,c=(0,a.useMemo)(()=>{let e,l;if(!t.startISO||!t.endISO)return null;try{if(e=(0,s.b)((0,x.D)(t.startISO)),l=(0,s.b)((0,x.D)(t.endISO)),isNaN(e.getTime())||isNaN(l.getTime()))return null}catch(e){return null}let a=(0,s.b)(n),o=(0,M.w)(l,e)+1,c=0;(0,i.A)(a,e)&&(c=(0,M.w)(a,e)),(0,j.R)(a,e)&&(c=0),(0,i.A)(a,l)&&(c=o);let d=0;(0,j.R)(a,e)||(0,i.A)(a,l)||(d=(0,M.w)(a,e)+1);let u=o-c,m=0;if((0,i.A)(a,l))m=100;else if((0,j.R)(a,e))m=0;else{let t=(0,y.i)(l),a=(0,w.c)(t,e),r=(0,w.c)(n,e);m=a<=0?100:Math.min(100,Math.max(0,r/a*100))}return{totalDays:o,daysPassed:c,daysRemaining:u,progressPercent:m,isEnded:(0,i.A)(a,l),isUpcoming:(0,j.R)(a,e),currentDayIndex:d,formattedStart:(0,r.WU)(e,"yyyy.MM.dd"),formattedEnd:(0,r.WU)(l,"yyyy.MM.dd")}},[t,n]);return c?(0,l.jsxs)("div",{className:"mb-8 flex flex-col gap-6",children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h2",{className:"text-2xl font-bold text-zinc-900 flex items-center gap-2",children:[t.name,c.isEnded&&(0,l.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-zinc-100 text-zinc-500 font-medium",children:"已结束"}),c.isUpcoming&&(0,l.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-600 font-medium",children:"未开始"}),!c.isEnded&&!c.isUpcoming&&(0,l.jsx)("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium ".concat(o.progressTag),children:"进行中"})]}),(0,l.jsxs)("div",{className:"text-sm text-zinc-500 mt-1 font-medium tabular-nums",children:[c.formattedStart," - ",c.formattedEnd,(0,l.jsx)("span",{className:"mx-2",children:"\xb7"}),"共 ",c.totalDays," 天"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-6",children:[!c.isUpcoming&&!c.isEnded&&(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("div",{className:"text-sm text-zinc-500",children:"已过"}),(0,l.jsxs)("div",{className:"text-2xl font-bold tabular-nums text-emerald-600",children:[c.daysPassed,(0,l.jsx)("span",{className:"text-sm font-normal text-zinc-400 ml-1",children:"天"})]})]}),!c.isUpcoming&&!c.isEnded&&(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("div",{className:"text-sm text-zinc-500",children:"剩余"}),(0,l.jsxs)("div",{className:"text-2xl font-bold text-zinc-900 tabular-nums",children:[c.daysRemaining,(0,l.jsx)("span",{className:"text-sm font-normal text-zinc-400 ml-1",children:"天"})]})]}),c.isUpcoming&&(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("div",{className:"text-sm text-zinc-500",children:"距离开始"}),(0,l.jsxs)("div",{className:"text-2xl font-bold text-blue-600 tabular-nums",children:[(0,M.w)((0,x.D)(t.startISO),n),(0,l.jsx)("span",{className:"text-sm font-normal text-zinc-400 ml-1",children:"天"})]})]})]})]}),(0,l.jsxs)("div",{className:"relative h-4 w-full overflow-hidden rounded-full bg-zinc-100",children:[(0,l.jsx)(C.E.div,{className:"absolute inset-y-0 left-0 bg-gradient-to-r ".concat(o.progressBarFrom," ").concat(o.progressBarTo),initial:{width:0},animate:{width:"".concat(c.progressPercent,"%")},transition:{duration:1,ease:"easeOut"}}),(0,l.jsx)("div",{className:"absolute inset-0 opacity-10 bg-[length:10px_10px] bg-[linear-gradient(45deg,rgba(255,255,255,0.5)_25%,transparent_25%,transparent_50%,rgba(255,255,255,0.5)_50%,rgba(255,255,255,0.5)_75%,transparent_75%,transparent)]"})]}),(0,l.jsxs)("div",{className:"flex justify-between text-xs font-medium text-zinc-400 mt-[-16px]",children:[(0,l.jsx)("span",{children:"0%"}),(0,l.jsxs)("span",{className:"tabular-nums ".concat(o.progressText),children:[c.progressPercent.toFixed(3),"%"]}),(0,l.jsx)("span",{children:"100%"})]})]}):null}function eo(e){var t;let{viewMode:n,activeRange:s,rangeStart:i,now:o,isEditingRange:c,rangeDraftName:d,highlightWeekends:u,setHighlightWeekends:m,highlightHolidays:x,setHighlightHolidays:h}=e,[g,b]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{if("range"===n)try{if("1"===localStorage.getItem("yeargrid_range_hint_seen_v1"))return;localStorage.setItem("yeargrid_range_hint_seen_v1","1"),b(!0);let e=window.setTimeout(()=>b(!1),8e3);return()=>window.clearTimeout(e)}catch(t){b(!0);let e=window.setTimeout(()=>b(!1),8e3);return()=>window.clearTimeout(e)}},[n]),"range"===n&&s&&!c)?(0,l.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)(es,{showWeekends:u,onToggleWeekends:()=>m(!u),showHolidays:x,onToggleHolidays:()=>h(!x)})}),g?(0,l.jsx)("div",{className:"text-xs text-zinc-500",children:"篇章：自定义一段时间范围，用来做目标、阶段或倒数。"}):null,(0,l.jsx)(ei,{range:s,now:o})]}):(0,l.jsxs)("div",{className:"mb-6 flex flex-wrap items-start justify-between gap-4",children:[(0,l.jsx)("div",{className:"text-xl font-semibold text-zinc-900",children:"year"===n?(0,r.WU)(i,"yyyy年"):"month"===n?(0,r.WU)(i,"M月"):"week"===n?"本周":(null===(t=c?d:null==s?void 0:s.name)||void 0===t?void 0:t.trim())||"区间"}),(0,l.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,l.jsx)(es,{showWeekends:u,onToggleWeekends:()=>m(!u),showHolidays:x,onToggleHolidays:()=>h(!x)}),"range"===n&&g?(0,l.jsx)("div",{className:"text-xs text-zinc-500",children:"篇章：自定义一段时间范围，用来做目标、阶段或倒数。"}):null]})]})}function ec(e){let{holidays:t,initialNowISO:n}=e,[z,D]=(0,a.useState)(!1),C=(0,a.useRef)(null),E=(0,a.useRef)(null),R=(0,a.useRef)(null),T=(0,a.useRef)(null),F=(0,a.useRef)(null),_=(0,a.useRef)(null),[B,W]=(0,a.useState)(null),A=(0,a.useRef)(null),[U,L]=(0,a.useState)(null),J=(0,a.useRef)(null),{viewMode:Y,setViewMode:Q,anchorISO:X,setAnchorISO:$,customStartISO:ee,setCustomStartISO:et,customEndISO:er,setCustomEndISO:es,ranges:ei,setRanges:ec,activeRangeId:ed,setActiveRangeId:eu,activeRange:em,rangeDraftStartISO:ex,setRangeDraftStartISO:eh,rangeDraftEndISO:eg,setRangeDraftEndISO:eb,rangeDraftName:ef,setRangeDraftName:ep,entries:ev,selectedISODate:ey,setSelectedISODate:ew,focusedISODate:ej,setFocusedISODate:eN,highlightWeekends:eS,setHighlightWeekends:ez,highlightHolidays:eD,setHighlightHolidays:ek,highlightThisMonth:eM,setHighlightThisMonth:eI,recordFilter:eO,setRecordFilter:eC,noteOnly:eE,setNoteOnly:eR,stateFilters:eT,noteQuery:eF,setNoteQuery:e_,guideDismissed:eB,showFilters:eW,setShowFilters:eA,isEditingRange:eU,setIsEditingRange:eH,isRangeEditing:eL,isCreatingRange:eZ,rangeDraftColor:eP,setRangeDraftColor:eq,rangeDraftSaving:eK,setRangeDraftSaving:eG,rangeDraftValid:eV,dragStartISO:eJ,setDragStartISO:eY,dragCurrentISO:eQ,setDragCurrentISO:eX,isDragging:e$,setIsDragging:e0,setIOStatus:e1,applyRangeDraftToActive:e2,deleteActiveRange:e5,beginCreateRange:e4,cancelCreateRange:e6,toggleStateFilter:e3,clearFilters:e9,exportData:e8,dismissGuide:e7,startNewRange:te,updateEntry:tt,deleteEntry:tn}=function(e){let{initialNowISO:t}=e,[n,l]=(0,a.useState)("month"),[c,d]=(0,a.useState)(()=>(0,r.WU)(new Date,"yyyy-MM-dd")),[u,m]=(0,a.useState)(""),[h,g]=(0,a.useState)(""),[b,f]=(0,a.useState)([]),[p,v]=(0,a.useState)(null),[y,w]=(0,a.useState)(""),[j,N]=(0,a.useState)(""),[S,z]=(0,a.useState)(""),[D,k]=(0,a.useState)(!1),[M,I]=(0,a.useState)(!1),[O,C]=(0,a.useState)({}),[E,R]=(0,a.useState)(!1),[T,F]=(0,a.useState)(null),[_,B]=(0,a.useState)(null),[W,A]=(0,a.useState)(!0),[U,H]=(0,a.useState)(!0),[L,Z]=(0,a.useState)(!1),[J,Y]=(0,a.useState)("all"),[Q,X]=(0,a.useState)(!1),[$,ee]=(0,a.useState)([]),[et,en]=(0,a.useState)(""),[el,ea]=(0,a.useState)(!0),[er,es]=(0,a.useState)(!1),[ei,eo]=(0,a.useState)(!1),[ec,ed]=(0,a.useState)("emerald"),[eu,em]=(0,a.useState)(!1),[ex,eh]=(0,a.useState)(null),[eg,eb]=(0,a.useState)(null),[ef,ep]=(0,a.useState)(!1),[ev,ey]=(0,a.useState)(null),ew=(0,a.useRef)(null),ej=(0,a.useRef)(null),eN=(0,a.useRef)(null),eS=(0,a.useRef)(null),ez=(0,a.useMemo)(()=>{var e;return p&&null!==(e=b.find(e=>e.id===p))&&void 0!==e?e:null},[p,b]),eD="range"===n&&ei,ek=eD&&null===p,eM=(0,a.useMemo)(()=>{try{let e=(0,s.b)((0,x.D)(y)),t=(0,s.b)((0,x.D)(j));return!(0,i.A)(e,t)}catch(e){return!1}},[j,y]);(0,a.useEffect)(()=>{var e,t;let n={id:"default",name:"我的年份",startISO:(0,r.WU)(new Date(new Date().getFullYear(),0,1),"yyyy-MM-dd"),endISO:(0,r.WU)(new Date(new Date().getFullYear(),11,31),"yyyy-MM-dd"),color:"emerald"},a=localStorage.getItem("yeargrid_ranges_v1"),s=[],i=!1,o=null,c=null!==a;if(a){let e=q(a);null===(o=G(e))&&null!==e&&(i=!0),s=null!=o?o:[]}0!==s.length||i?i&&(s=null!=o?o:[]):s=[n];let u=localStorage.getItem("yeargrid_entries_v1");if(u){let e=K(q(u));e&&Object.keys(e).length>0&&(0!==s.length||c?s[0]&&(!s[0].entries||0===Object.keys(s[0].entries).length)&&(s[0].entries=e):s=[{...n,entries:e}])}f(s),I(!0);let x=V(q(localStorage.getItem("yeargrid_view_pref_v1"))),h=null!==(t=null===(e=s[0])||void 0===e?void 0:e.id)&&void 0!==t?t:null;if(null==x?void 0:x.activeRangeId){let e=s.find(e=>e.id===x.activeRangeId);e&&(h=e.id)}if(v(h),h){let e=s.find(e=>e.id===h);e&&(m(e.startISO),g(e.endISO),w(e.startISO),N(e.endISO),z(e.name),C(e.entries||{}))}else C({});x&&(x.mode&&l(x.mode),x.anchorISO&&d(x.anchorISO)),R(!0),k(!0),ea("1"===localStorage.getItem("yeargrid_guide_dismissed_v1"))},[]),(0,a.useEffect)(()=>{E&&M&&p&&f(e=>{let t=e.findIndex(e=>e.id===p);if(-1===t||e[t].entries===O)return e;let n=[...e];return n[t]={...e[t],entries:O},n})},[O,p,E,M]),(0,a.useEffect)(()=>{M&&localStorage.setItem("yeargrid_ranges_v1",JSON.stringify(b))},[b,M]),(0,a.useEffect)(()=>{if(!M||!p||ew.current===p)return;ew.current=p;let e=b.find(e=>e.id===p);if(!e){C({});return}C(e.entries||{}),m(e.startISO),g(e.endISO),w(e.startISO),N(e.endISO),z(e.name)},[p,b,M]),(0,a.useEffect)(()=>{D&&localStorage.setItem("yeargrid_view_pref_v1",JSON.stringify({mode:n,anchorISO:c,customStartISO:u,customEndISO:h,activeRangeId:p}))},[p,c,h,u,n,D]);let eI=(0,a.useCallback)(()=>{if(!eM)return;m(y),g(j);let e=S.trim()||"新篇章";if(!p){let t="range_".concat(Date.now());f(n=>{let l=P(e,n);return[...n,{id:t,name:l,startISO:y,endISO:j,color:ec}]}),v(t);return}f(t=>t.map(t=>t.id===p?{...t,name:e,startISO:y,endISO:j,color:ec}:t))},[p,ec,j,S,y,eM]),eO=(0,a.useCallback)(()=>{var e;if(!p)return;let t=b.findIndex(e=>e.id===p);if(t<0)return;let n=b.filter(e=>e.id!==p),l=n.length>0?n[Math.min(t,n.length-1)]:null;f(n),v(null!==(e=null==l?void 0:l.id)&&void 0!==e?e:null),l?(m(l.startISO),g(l.endISO),w(l.startISO),N(l.endISO),z(l.name),C(l.entries||{})):C({}),eo(!1)},[p,b]),eC=(0,a.useCallback)(e=>{var t,n,l;let a=(0,s.b)(new Date),i=null!==(n=null==e?void 0:e.startISO)&&void 0!==n?n:(0,r.WU)(a,"yyyy-MM-dd"),c=null!==(l=null==e?void 0:e.endISO)&&void 0!==l?l:(0,r.WU)((0,o.E)(a,100),"yyyy-MM-dd");ej.current=p,(null==e?void 0:e.setVisibleDefault)&&(eN.current=u,eS.current=h,m(i),g(c)),v(null),z(P((null==e?void 0:null===(t=e.name)||void 0===t?void 0:t.trim())||"新篇章",b)),w((null==e?void 0:e.prefillDraft)?i:""),N((null==e?void 0:e.prefillDraft)?c:""),ed("emerald"),eo(!0),em(!1)},[p,h,u,b]),eE=(0,a.useCallback)(()=>{eD&&null===p&&(ep(!1),eh(null),eb(null),z(""),ed("emerald"),em(!1),eo(!1),v(ej.current),ej.current=null,eN.current&&eS.current&&(m(eN.current),g(eS.current)),eN.current=null,eS.current=null)},[p,eD]),eR=(0,a.useCallback)(e=>{0!==e&&ee(t=>{let n=t.includes(e)?t.filter(t=>t!==e):[...t,e];return n.sort((e,t)=>e-t),n})},[]),eT=(0,a.useCallback)(()=>{A(!0),H(!0),Z(!1),Y("all"),X(!1),ee([]),en("")},[]),eF=(0,a.useCallback)(()=>{let e=new Blob([JSON.stringify({version:1,exportedAtISO:new Date().toISOString(),entries:O,ranges:b,viewPref:{mode:n,anchorISO:c,customStartISO:u,customEndISO:h,activeRangeId:p},guideDismissed:el},null,2)],{type:"application/json;charset=utf-8"}),t=URL.createObjectURL(e),l=document.createElement("a");l.href=t,l.download="yeargrid_backup_".concat((0,r.WU)(new Date,"yyyyMMdd_HHmmss"),".json"),document.body.appendChild(l),l.click(),l.remove(),window.setTimeout(()=>URL.revokeObjectURL(t),5e3),ey({kind:"ok",message:"已导出备份文件。"})},[p,c,h,u,O,el,b,n]),e_=(0,a.useCallback)(async e=>{var t,n,a,r,s;let i=null!==(n=null===(t=e.target.files)||void 0===t?void 0:t[0])&&void 0!==n?n:null;if(e.target.value="",!i)return;if(i.size>5242880){ey({kind:"error",message:"导入失败：文件过大（请使用 5MB 以内）。"});return}let o="";try{o=await i.text()}catch(e){ey({kind:"error",message:"导入失败：无法读取文件内容。"});return}let c=q(o);if(!c||"object"!=typeof c){ey({kind:"error",message:"导入失败：文件不是有效的 JSON 对象。"});return}let u=K(null!==(a=c.entries)&&void 0!==a?a:c),x=G(c.ranges),h=V(null!==(r=c.viewPref)&&void 0!==r?r:c),p=!!(u&&Object.keys(u).length>0),y=null!==x&&x.length>0,j="boolean"==typeof c.guideDismissed;if(!p&&!y&&!(null!==h)&&!j){ey({kind:"error",message:"导入失败：未识别到可用数据。"});return}let S=window.confirm("导入会覆盖本地数据。确定=覆盖；取消=合并。"),D=S?null!=u?u:{}:{...O,...null!=u?u:{}},k=x&&x.length>0?S?x:function(e,t){let n=new Set(e.map(e=>e.id)),l=new Set(e.map(e=>e.name.trim())),a=[...e];for(let e of t){let t=e.id;(!t||n.has(t))&&(t="range_".concat(Date.now(),"_").concat(Math.floor(1e5*Math.random()))),n.add(t);let r=e.name.trim()||"区间";if(l.has(r)){let e=2;for(;l.has("".concat(r,"-").concat(e));)e+=1;r="".concat(r,"-").concat(e)}l.add(r),a.push({...e,id:t,name:r})}return a}(b,x):b;if(C(D),x&&x.length>0&&f(k),S&&h){h.mode&&l(h.mode),h.anchorISO&&d(h.anchorISO);let e=h.activeRangeId&&null!==(s=k.find(e=>e.id===h.activeRangeId))&&void 0!==s?s:null;e?(v(e.id),m(e.startISO),g(e.endISO),w(e.startISO),N(e.endISO),z(e.name)):h.customStartISO&&h.customEndISO&&(v(null),m(h.customStartISO),g(h.customEndISO),w(h.customStartISO),N(h.customEndISO),z(""))}"boolean"==typeof c.guideDismissed&&ea(c.guideDismissed),eo(!1),ey({kind:"ok",message:S?"导入完成：已覆盖本地数据。":"导入完成：已合并本地数据。"})},[O,b]);return{viewMode:n,setViewMode:l,anchorISO:c,setAnchorISO:d,customStartISO:u,setCustomStartISO:m,customEndISO:h,setCustomEndISO:g,ranges:b,setRanges:f,activeRangeId:p,setActiveRangeId:v,activeRange:ez,rangeDraftStartISO:y,setRangeDraftStartISO:w,rangeDraftEndISO:j,setRangeDraftEndISO:N,rangeDraftName:S,setRangeDraftName:z,entries:O,setEntries:C,selectedISODate:T,setSelectedISODate:F,focusedISODate:_,setFocusedISODate:B,highlightWeekends:W,setHighlightWeekends:A,highlightHolidays:U,setHighlightHolidays:H,highlightThisMonth:L,setHighlightThisMonth:Z,recordFilter:J,setRecordFilter:Y,noteOnly:Q,setNoteOnly:X,stateFilters:$,setStateFilters:ee,noteQuery:et,setNoteQuery:en,guideDismissed:el,setGuideDismissed:ea,showFilters:er,setShowFilters:es,isEditingRange:ei,setIsEditingRange:eo,isRangeEditing:eD,isCreatingRange:ek,rangeDraftColor:ec,setRangeDraftColor:ed,rangeDraftSaving:eu,setRangeDraftSaving:em,rangeDraftValid:eM,dragStartISO:ex,setDragStartISO:eh,dragCurrentISO:eg,setDragCurrentISO:eb,isDragging:ef,setIsDragging:ep,ioStatus:ev,setIOStatus:ey,applyRangeDraftToActive:eI,deleteActiveRange:eO,beginCreateRange:eC,cancelCreateRange:eE,toggleStateFilter:eR,clearFilters:eT,exportData:eF,onImportFileChange:e_,dismissGuide:()=>{localStorage.setItem("yeargrid_guide_dismissed_v1","1"),ea(!0)},startNewRange:()=>{l("range"),eC({setVisibleDefault:!0})},updateEntry:(e,t,n)=>{C(l=>({...l,[e]:{state:t,note:n.slice(0,50),updatedAtISO:new Date().toISOString()}}))},deleteEntry:e=>{C(t=>{let n={...t};return delete n[e],n})}}}({initialNowISO:n}),{now:tl,percent:ta,remaining:tr,days:ts,rangeStart:ti,rangeEnd:to}=function(e,t,n){var l,o;let[c,d]=(0,a.useState)(()=>t?new Date(t):new Date);(0,a.useEffect)(()=>{let e=window.setInterval(()=>d(new Date),1e3);return()=>window.clearInterval(e)},[]);let u=null!==(l=null==n?void 0:n.mode)&&void 0!==l?l:"year",m=null!==(o=null==n?void 0:n.anchorISO)&&void 0!==o?o:"",z=(0,a.useMemo)(()=>{if(!m)return null;try{return(0,x.D)(m)}catch(e){return null}},[m]),D=null!=z?z:c,k=(0,a.useMemo)(()=>{switch(u){case"year":return(0,h.e)(D);case"month":return(0,g.N)(D);case"week":return(0,b.z)(D,{weekStartsOn:1});case"range":if(!(null==n?void 0:n.customStartISO)||!(null==n?void 0:n.customEndISO))return(0,h.e)(D);try{let e=(0,s.b)((0,x.D)(n.customStartISO)),t=(0,s.b)((0,x.D)(n.customEndISO));if((0,i.A)(e,t))return(0,h.e)(D);return e}catch(e){return(0,h.e)(D)}}},[D,u,null==n?void 0:n.customEndISO,null==n?void 0:n.customStartISO]),M=(0,a.useMemo)(()=>{switch(u){case"year":return(0,f.w)(D);case"month":return(0,p.V)(D);case"week":return(0,v.v)(D,{weekStartsOn:1});case"range":if(!(null==n?void 0:n.customStartISO)||!(null==n?void 0:n.customEndISO))return(0,f.w)(D);try{let e=(0,s.b)((0,x.D)(n.customStartISO)),t=(0,s.b)((0,x.D)(n.customEndISO));if((0,i.A)(e,t))return(0,f.w)(D);return(0,y.i)(t)}catch(e){return(0,f.w)(D)}}},[D,u,null==n?void 0:n.customEndISO,null==n?void 0:n.customStartISO]),I=c.getFullYear(),O=c.getMonth(),C=c.getDate(),E=(0,a.useMemo)(()=>(0,s.b)(new Date(I,O,C)),[I,O,C]),R=(0,a.useMemo)(()=>Math.max(0,(0,w.c)(M,c)),[c,M]),T=(0,a.useMemo)(()=>(function(e){let t=Math.max(0,e);return{days:Math.floor(t/86400),hours:Math.floor(t%86400/3600),minutes:Math.floor(t%3600/60),seconds:t%60}})(R),[R]),F=(0,a.useMemo)(()=>{let e=(0,w.c)(M,k),t=(0,j.R)(c,k)?k:(0,i.A)(c,M)?M:c,n=(0,w.c)(t,k);return e<=0?100:Math.min(100,Math.max(0,n/e*100))},[c,M,k]),_=(0,a.useMemo)(()=>{let t=(0,N.D)({start:k,end:M}),n=t.length;return t.map((t,l)=>{let a=l+1,s=(0,S.K)(t,E)?"today":(0,j.R)(t,E)?"past":"future",i=Math.max(0,n-a),o="".concat((0,r.WU)(t,"yyyy年MM月dd日")," \xb7 第").concat(a,"/").concat(n,"天"),c=(0,r.WU)(t,"yyyy-MM-dd"),d=null==e?void 0:e[c],u=t.getMonth()+1,m=0===t.getDay()||6===t.getDay(),x=1===t.getDate();return{date:t,isoDate:c,month:u,isWeekend:m,isMonthStart:x,dayOfYear:a,state:s,daysLeft:i,label:o,holiday:d}})},[e,M,k,E]);return{now:c,rangeStart:k,rangeEnd:M,mode:u,percent:F,remaining:T,days:_}}(t,n,{mode:Y,anchorISO:X,customStartISO:ee,customEndISO:er}),{columns:tc}=function(e){let{rootRef:t,headerRef:n,viewMode:l,daysCount:r}=e,[s,i]=(0,a.useState)(32),[o,c]=(0,a.useState)(void 0),d=(0,a.useRef)(s);return(0,a.useEffect)(()=>{d.current=s},[s]),(0,a.useEffect)(()=>{let e=t.current,a=n.current;if(!e||!a)return;let s=()=>{let t=e.getBoundingClientRect(),n=a.getBoundingClientRect(),s=Math.max(0,t.width),o=Math.max(0,t.height-n.height-20),u="month"===l||"week"===l||"range"===l?8:6,x=m(32,12,48),h=0;if("year"===l){i(e=>7===e?e:7),c(e=>void 0===e?e:void 0);return}if("month"===l||"week"===l||"range"===l){x="week"===l?7:s<640?7:10,i(e=>e===x?e:x),c(e=>void 0===e?e:void 0);return}let g=m(d.current,12,48),b=[];for(let e=12;e<=48;e+=1){let t=Math.floor((s-u*(e-1))/e);if(t<=2)continue;let n=Math.ceil(r/e),l=n*t+u*(n-1);l<=o&&b.push({cols:e,cellSize:t}),l<=o&&t>h&&(x=e,h=t)}if(0===h)x=m(Math.round(s/18),12,48),h=Math.floor((s-u*(x-1))/x);else{let e=b.filter(e=>e.cellSize>=h-1);e.length>0&&(e.sort((e,t)=>{let n=Math.abs(e.cols-g),l=Math.abs(t.cols-g);return n!==l?n-l:e.cellSize!==t.cellSize?t.cellSize-e.cellSize:e.cols-t.cols}),x=e[0].cols,h=e[0].cellSize)}if(i(e=>e===x?e:x),"range"===l){if(h>52){let e=52*x+(x-1)*u;c(t=>t===e?t:e)}else c(e=>void 0===e?e:void 0)}else c(e=>void 0===e?e:void 0)},o=0,u=()=>{o||(o=window.requestAnimationFrame(()=>{o=0,s()}))};u();let x=new ResizeObserver(()=>u());return x.observe(e),x.observe(a),window.addEventListener("resize",u),()=>{window.removeEventListener("resize",u),x.disconnect(),o&&window.cancelAnimationFrame(o)}},[r,n,t,l]),{columns:s,gridMaxWidth:o}}({rootRef:C,headerRef:E,viewMode:Y,daysCount:ts.length}),{tooltip:td,setTooltip:tu,tooltipRef:tm,clampPosition:tx}=function(e){let{getKey:t,margin:n=12}=e,[l,r]=(0,a.useState)(null),s=(0,a.useRef)(null),i=(0,a.useRef)(null),o=(0,a.useRef)(null);(0,a.useEffect)(()=>{o.current=l},[l]);let c=(0,a.useMemo)(()=>l?t(l.data):null,[t,l]),d=(0,a.useCallback)((e,t)=>{let l=i.current;if(!l)return{x:u(e,n,window.innerWidth-n),y:u(t,n,window.innerHeight-n)};let a=Math.max(n,window.innerWidth-n-l.w),r=Math.max(n,window.innerHeight-n-l.h);return{x:u(e,n,a),y:u(t,n,r)}},[n]);return(0,a.useEffect)(()=>{if(!c){i.current=null;return}i.current=null;let e=window.requestAnimationFrame(()=>{let e=s.current;if(!e)return;let t=e.getBoundingClientRect();i.current={w:t.width,h:t.height};let l=Math.max(n,window.innerWidth-n-t.width),a=Math.max(n,window.innerHeight-n-t.height);r(e=>{if(!e)return e;let t=u(e.x,n,l),r=u(e.y,n,a);return 1>Math.abs(t-e.x)&&1>Math.abs(r-e.y)?e:{...e,x:t,y:r}})});return()=>{window.cancelAnimationFrame(e)}},[n,c]),(0,a.useEffect)(()=>{let e=()=>{if(!o.current)return;let e=s.current;if(!e)return;let t=e.getBoundingClientRect();i.current={w:t.width,h:t.height};let l=Math.max(n,window.innerWidth-n-t.width),a=Math.max(n,window.innerHeight-n-t.height);r(e=>{if(!e)return e;let t=u(e.x,n,l),r=u(e.y,n,a);return 1>Math.abs(t-e.x)&&1>Math.abs(r-e.y)?e:{...e,x:t,y:r}})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[n]),{tooltip:l,setTooltip:r,tooltipRef:s,clampPosition:d}}({getKey:e=>e.isoDate}),th=(0,a.useMemo)(()=>parseInt((null==n?void 0:n.slice(0,4))||(0,r.WU)(new Date,"yyyy")),[n]),tg=(0,a.useMemo)(()=>parseInt((null==n?void 0:n.slice(5,7))||(0,r.WU)(new Date,"MM"))-1,[n]),tb=(0,a.useMemo)(()=>parseInt((null==n?void 0:n.slice(8,10))||(0,r.WU)(new Date,"dd")),[n]),tf=(0,a.useMemo)(()=>{let e=new Map;return ts.forEach((t,n)=>{e.set(t.isoDate,n)}),e},[ts]),tp=(0,a.useMemo)(()=>tg+1,[tg]),tv=(0,a.useMemo)(()=>(0,s.b)(new Date(th,tg,tb)),[th,tg,tb]),ty=(0,a.useMemo)(()=>eZ?function(e){let{now:t,todayStart:n,dragStartISO:l,dragCurrentISO:a,isDragging:r,rangeDraftStartISO:o,rangeDraftEndISO:c}=e,d=r&&l&&a&&l!==a?{startISO:l<a?l:a,endISO:l>a?l:a}:o&&c?{startISO:o,endISO:c}:null;if(!d)return null;try{let e=(0,s.b)((0,x.D)(d.startISO)),l=(0,s.b)((0,x.D)(d.endISO));if((0,i.A)(e,l))return null;let a=(0,y.i)(l),r=(0,w.c)(a,e),o=(0,j.R)(t,e)?e:(0,i.A)(t,a)?a:t,c=(0,w.c)(o,e),u=Math.max(0,(0,w.c)(a,t)),m="".concat(Math.floor(u/86400),"天 ").concat(Math.floor(u%86400/3600).toString().padStart(2,"0"),":").concat(Math.floor(u%3600/60).toString().padStart(2,"0"),":").concat((u%60).toString().padStart(2,"0")),h=(0,M.w)(l,e)+1,g=(0,j.R)(t,e)?0:(0,i.A)(t,a)?h:(0,M.w)(n,e)+1;return{startISO:d.startISO,endISO:d.endISO,percent:r<=0?100:Math.min(100,Math.max(0,c/r*100)),remainingText:m,elapsedDays:g,totalDays:h}}catch(e){return null}}({now:tl,todayStart:tv,dragStartISO:eJ,dragCurrentISO:eQ,isDragging:e$,rangeDraftStartISO:ex,rangeDraftEndISO:eg}):null,[eQ,eJ,eZ,e$,tl,eg,ex,tv]),tw=(0,a.useCallback)(()=>{var e;e1(null),null===(e=_.current)||void 0===e||e.click()},[e1]),tj=(0,a.useMemo)(()=>"".concat(Math.floor(ta).toString(),"%"),[ta]),tN=(0,a.useMemo)(()=>{var e;let t=ts.findIndex(e=>"today"===e.state);if(t>=0)return t;if(0===ts.length)return 0;let n=null===(e=ts[ts.length-1])||void 0===e?void 0:e.date;return n&&(0,i.A)(tl,n)?ts.length:0},[ts,tl]),tS=(0,a.useMemo)(()=>{let e=tr.hours.toString().padStart(2,"0"),t=tr.minutes.toString().padStart(2,"0"),n=tr.seconds.toString().padStart(2,"0");return"".concat(tr.days,"天 ").concat(e,":").concat(t,":").concat(n)},[tr.days,tr.hours,tr.minutes,tr.seconds]),tz=(0,a.useMemo)(()=>{var e;return ey&&null!==(e=ts.find(e=>e.isoDate===ey))&&void 0!==e?e:null},[ts,ey]);(0,a.useEffect)(()=>{if(!tz)return;F.current=document.activeElement instanceof HTMLElement?document.activeElement:null,requestAnimationFrame(()=>{var e;return null===(e=T.current)||void 0===e?void 0:e.focus()});let e=e=>{"Escape"===e.key&&ew(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[tz,ew]),(0,a.useEffect)(()=>{var e;tz||null===(e=F.current)||void 0===e||e.focus()},[tz]);let tD=(0,a.useMemo)(()=>{var e;return tz&&null!==(e=ev[tz.isoDate])&&void 0!==e?e:null},[ev,tz]),{handleCellFocus:tk,handleCellBlur:tM,handleCellHover:tI,handleCellMouseDown:tO,handleCellMouseUp:tC,handleCellMove:tE,handleCellLeave:tR,handleCellClick:tT,handleCellKeyDown:tF}=function(e){let{viewMode:t,isEditingRange:n,isRangeEditing:l,isDragging:r,setIsDragging:s,dragStartISO:i,setDragStartISO:o,dragCurrentISO:c,setDragCurrentISO:d,setSelectedISODate:u,setFocusedISODate:m,setTooltip:h,clampTooltipPosition:g,setRangeDraftStartISO:b,setRangeDraftEndISO:f,activeRangeId:p,customStartISO:v,setCustomStartISO:y,customEndISO:w,setCustomEndISO:N,days:S,dayIndexByISO:z,columns:D,focusCell:k}=e,M=(0,a.useCallback)((e,t)=>{let n=t.currentTarget.getBoundingClientRect(),{x:l,y:a}=g(n.right+12,n.top+12);h({data:e,x:l,y:a}),m(e.isoDate)},[g,h,m]),I=(0,a.useCallback)(e=>{h(t=>(null==t?void 0:t.data.isoDate)===e.isoDate?null:t)},[h]),O=(0,a.useCallback)((e,t)=>{let{x:n,y:a}=g(t.clientX+12,t.clientY+12);h({data:e,x:n,y:a}),l&&r&&d(e.isoDate)},[g,r,l,h,d]),C=(0,a.useCallback)(e=>{"range"===t&&n&&(s(!0),o(e.isoDate),d(e.isoDate))},[n,t,s,o,d]),E=(0,a.useCallback)(e=>{if(!n||!r||!i)return;s(!1);let t=(0,x.D)(i),l=(0,x.D)(e.isoDate),a=(0,j.R)(t,l)?i:e.isoDate,c=(0,j.R)(t,l)?e.isoDate:i;if(a===c){o(null),d(null);return}b(a),f(c),null===p&&((!v||a<v)&&y(a),(!w||c>w)&&N(c)),o(null),d(null)},[p,w,v,i,r,n,s,o,d,b,f,y,N]),R=(0,a.useCallback)((e,t)=>{h(n=>{if(!n||n.data.isoDate!==e.isoDate)return n;let{x:l,y:a}=g(t.clientX+12,t.clientY+12);return{data:n.data,x:l,y:a}})},[g,h]),T=(0,a.useCallback)(()=>h(null),[h]),F=(0,a.useCallback)(e=>{"range"===t&&n||(m(e.isoDate),u(e.isoDate))},[n,t,m,u]),_=(0,a.useCallback)((e,t)=>{var n,l;if(("ArrowLeft"===t.key||"ArrowRight"===t.key||"ArrowUp"===t.key||"ArrowDown"===t.key||"Home"===t.key||"End"===t.key)&&t.preventDefault(),"Enter"===t.key||" "===t.key){t.preventDefault(),F(e);return}let a=z.get(e.isoDate);if(void 0===a)return;let r=null;if("ArrowLeft"===t.key&&(r=a-1),"ArrowRight"===t.key&&(r=a+1),"ArrowUp"===t.key&&(r=a-D),"ArrowDown"===t.key&&(r=a+D),"Home"===t.key&&(r=0),"End"===t.key&&(r=S.length-1),null===r)return;l=r,r=Math.min(S.length-1,Math.max(0,l));let s=null===(n=S[r])||void 0===n?void 0:n.isoDate;s&&(m(s),requestAnimationFrame(()=>k(s)))},[D,z,S,k,F,m]);return{handleCellFocus:M,handleCellBlur:I,handleCellHover:O,handleCellMouseDown:C,handleCellMouseUp:E,handleCellMove:R,handleCellLeave:T,handleCellClick:F,handleCellKeyDown:_}}({viewMode:Y,isEditingRange:eU,isRangeEditing:eL,isDragging:e$,setIsDragging:e0,dragStartISO:eJ,setDragStartISO:eY,dragCurrentISO:eQ,setDragCurrentISO:eX,setSelectedISODate:ew,setFocusedISODate:eN,setTooltip:tu,clampTooltipPosition:tx,setRangeDraftStartISO:eh,setRangeDraftEndISO:eb,activeRangeId:ed,customStartISO:ee,setCustomStartISO:et,customEndISO:er,setCustomEndISO:es,days:ts,dayIndexByISO:tf,columns:tc,focusCell:(0,a.useCallback)(e=>{let t=R.current;if(!t)return;let n=t.querySelector('[data-iso="'.concat(e,'"]'));null==n||n.focus()},[])}),t_="year"===Y&&eM,tB=(0,a.useMemo)(()=>!eB&&0===Object.keys(ev).length,[eB,ev]),tW="month"===Y||"week"===Y||"range"===Y?8:6;(0,a.useEffect)(()=>{"range"!==Y&&D(!1)},[Y]);let tA=(0,a.useCallback)(e=>{let t=ei.find(t=>t.id===e);t&&(eu(t.id),et(t.startISO),es(t.endISO),eh(t.startISO),eb(t.endISO),ep(t.name),eH(!1),D(!1))},[ei,eu,es,et,eH,eb,ep,eh]),tU=(0,a.useCallback)(()=>{e4({setVisibleDefault:!0}),D(!1)},[e4]),tH=(0,a.useCallback)(e=>{let t=(0,s.b)(tl),n=(0,r.WU)(t,"yyyy-MM-dd"),l=(()=>{switch(e){case"sprint_2w":return{name:"短期冲刺",end:(0,o.E)(t,13)};case"quarter_3m":return{name:"季度目标",end:(0,c.k)((0,d.z)(t,3),1)};default:return{name:"旅行倒数",end:(0,o.E)(t,6)}}})();e4({startISO:n,endISO:(0,r.WU)(l.end,"yyyy-MM-dd"),setVisibleDefault:!0,prefillDraft:!0,name:l.name}),D(!1)},[e4,tl]),tL=(0,a.useCallback)(e=>{eu(e.id),ep(e.name),eh(e.startISO),eb(e.endISO),eq(e.color||"emerald"),eH(!0),eG(!1),D(!1)},[eu,eH,eq,eb,ep,eG,eh]),tZ=(0,a.useCallback)(e=>{let t=ei.findIndex(t=>t.id===e);if(t<0)return;let n=ei.filter(t=>t.id!==e);if(ec(n),ed===e){var l,a;let e=null!==(l=n[Math.min(t,n.length-1)])&&void 0!==l?l:null;eu(null!==(a=null==e?void 0:e.id)&&void 0!==a?a:null),e&&(et(e.startISO),es(e.endISO))}},[ed,ei,eu,es,et,ec]),tP=(0,a.useCallback)(e=>{let t=ei.find(t=>t.id===e);if(!t)return;let n="range_".concat(Date.now()),l=P("".concat(t.name," 副本"),ei),a={...t,id:n,name:l};ec(e=>[...e,a]),eu(n),et(a.startISO),es(a.endISO)},[ei,eu,es,et,ec]),tq=(0,a.useCallback)(e=>{W(e),null!==A.current&&window.clearTimeout(A.current),A.current=window.setTimeout(()=>{W(t=>t===e?null:t)},1200)},[]),tK=(0,a.useCallback)((e,t)=>{L({isoDate:e,entry:t}),null!==J.current&&window.clearTimeout(J.current),J.current=window.setTimeout(()=>{L(null)},5e3)},[]);(0,a.useEffect)(()=>()=>{null!==A.current&&window.clearTimeout(A.current),null!==J.current&&window.clearTimeout(J.current)},[]);let tG=(0,a.useCallback)((e,t,n)=>{tt(e,t,n),tq(e)},[tq,tt]),tV=(0,a.useCallback)(e=>{var t;let n=null!==(t=ev[e])&&void 0!==t?t:null;tn(e),n&&tK(e,n)},[tn,ev,tK]),tJ=(0,a.useCallback)(()=>{U&&(tG(U.isoDate,U.entry.state,U.entry.note),L(null))},[tG,U]),tY=(0,a.useCallback)(e=>{var t,n,l,a;let r=((null!==(l=null===(t=ev[e])||void 0===t?void 0:t.state)&&void 0!==l?l:0)+1)%6;if(0===r){tn(e),tq(e);return}tG(e,r,null!==(a=null===(n=ev[e])||void 0===n?void 0:n.note)&&void 0!==a?a:"")},[tn,ev,tq,tG]),tQ=(0,a.useCallback)((e,t)=>{if(t.shiftKey){if("range"===Y&&eU)return;eN(e.isoDate),tY(e.isoDate);return}tT(e)},[tY,tT,eU,eN,Y]);return(0,l.jsxs)("div",{ref:C,className:"relative flex w-full flex-col",children:[(0,l.jsxs)("header",{ref:E,className:"mb-8",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between",children:[(0,l.jsx)(O,{percent:ta,percentText:tj,timeRemainingText:tS,elapsedDays:tN,totalDays:ts.length,viewMode:Y,rangeStart:ti,isCreatingRange:eZ,createRangePreview:ty}),(0,l.jsx)(en,{viewMode:Y,setViewMode:Q,anchorISO:X,setAnchorISO:$,rangeStart:ti,rangeEnd:to,now:tl,showFilters:eW,setShowFilters:eA,highlightWeekends:eS,setHighlightWeekends:ez,highlightHolidays:eD,setHighlightHolidays:ek,highlightThisMonth:eM,setHighlightThisMonth:eI,noteOnly:eE,setNoteOnly:eR,recordFilter:eO,setRecordFilter:eC,ranges:ei,activeRangeId:ed,setActiveRangeId:eu,activeRange:em,isEditingRange:eU,setIsEditingRange:eH,isRangeEditing:eL,rangeDraftName:ef,setRangeDraftName:ep,rangeDraftColor:eP,setRangeDraftColor:eq,rangeDraftStartISO:ex,setRangeDraftStartISO:eh,rangeDraftEndISO:eg,setRangeDraftEndISO:eb,rangeDraftValid:eV,rangeDraftSaving:eK,setRangeDraftSaving:eG,setTooltip:tu,setSelectedISODate:ew,deleteActiveRange:e5,applyRangeDraftToActive:e2,cancelCreateRange:e6,customStartISO:ee,setCustomStartISO:et,customEndISO:er,setCustomEndISO:es,stateFilters:eT,toggleStateFilter:e3,noteQuery:eF,setNoteQuery:e_,clearFilters:e9,exportData:e8,triggerImport:tw,openRangeNav:()=>D(!0)})]}),(0,l.jsx)(el,{visible:tB,onDismiss:e7})]}),(0,l.jsx)("div",{className:"w-full pb-12",children:"range"!==Y||0!==ei.length||eU?(0,l.jsx)("div",{className:"w-full rounded-2xl border border-zinc-200/60 bg-white p-6 shadow-sm",children:"range"===Y?(0,l.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[280px_1fr]",children:[(0,l.jsx)("div",{className:"hidden lg:block",children:(0,l.jsx)(H,{variant:"sidebar",now:tl,ranges:ei,activeRangeId:ed,onSelect:tA,onAdd:tU,onAddTemplate:tH,onEdit:tL,onDelete:tZ,onDuplicate:tP})}),(0,l.jsxs)("div",{className:"min-w-0",children:[(0,l.jsx)(eo,{viewMode:Y,activeRange:em,rangeStart:ti,now:tl,isEditingRange:eU,rangeDraftName:ef,highlightWeekends:eS,setHighlightWeekends:ez,highlightHolidays:eD,setHighlightHolidays:ek}),(0,l.jsx)(Z,{viewMode:Y,days:ts,columns:tc,gridGap:tW,entries:ev,selectedISODate:ey,focusedISODate:ej,highlightWeekends:eS,highlightHolidays:eD,effectiveHighlightThisMonth:t_,currentMonth:tp,recordFilter:eO,noteOnly:eE,stateFilters:eT,noteQuery:eF,isDragging:e$,dragStartISO:eJ,dragCurrentISO:eQ,isRangeEditing:eL,rangeDraftColor:eP,rangeDraftStartISO:ex,rangeDraftEndISO:eg,onCellHover:tI,onCellMove:tE,onCellLeave:tR,onCellFocus:tk,onCellBlur:tM,onCellKeyDown:tF,onCellClick:tQ,onCellMouseDown:tO,onCellMouseUp:tC})]}),(0,l.jsx)(H,{variant:"drawer",now:tl,open:z,onOpenChange:D,ranges:ei,activeRangeId:ed,onSelect:tA,onAdd:tU,onAddTemplate:tH,onEdit:tL,onDelete:tZ,onDuplicate:tP})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eo,{viewMode:Y,activeRange:em,rangeStart:ti,now:tl,isEditingRange:eU,rangeDraftName:ef,highlightWeekends:eS,setHighlightWeekends:ez,highlightHolidays:eD,setHighlightHolidays:ek}),(0,l.jsx)(Z,{viewMode:Y,days:ts,columns:tc,gridGap:tW,entries:ev,selectedISODate:ey,focusedISODate:ej,highlightWeekends:eS,highlightHolidays:eD,effectiveHighlightThisMonth:t_,currentMonth:tp,recordFilter:eO,noteOnly:eE,stateFilters:eT,noteQuery:eF,isDragging:e$,dragStartISO:eJ,dragCurrentISO:eQ,isRangeEditing:eL,rangeDraftColor:eP,rangeDraftStartISO:ex,rangeDraftEndISO:eg,onCellHover:tI,onCellMove:tE,onCellLeave:tR,onCellFocus:tk,onCellBlur:tM,onCellKeyDown:tF,onCellClick:tQ,onCellMouseDown:tO,onCellMouseUp:tC})]})}):(0,l.jsx)(ea,{onStartNewRange:te})}),U?(0,l.jsx)("div",{className:"fixed bottom-4 right-4 z-50 max-w-[90vw]",children:(0,l.jsxs)("div",{className:"flex items-center gap-3 rounded-xl border border-zinc-200/70 bg-white/90 px-4 py-3 text-sm text-zinc-900 shadow-[0_18px_60px_rgba(0,0,0,0.14)] backdrop-blur-xl",children:[(0,l.jsxs)("div",{className:"min-w-0",children:[(0,l.jsx)("div",{className:"font-medium",children:"已删除记录"}),(0,l.jsx)("div",{className:"mt-0.5 text-xs text-zinc-500 tabular-nums",children:U.isoDate})]}),(0,l.jsx)("button",{type:"button",onClick:tJ,className:"shrink-0 rounded-lg bg-zinc-900 px-3 py-1.5 text-xs font-medium text-white transition-colors hover:bg-zinc-800",children:"撤销"})]})}):null,td?(0,l.jsx)(I,{tooltip:td,tooltipRef:tm,todayStart:tv,entries:ev}):null,tz?(0,l.jsx)(k,{selectedDay:tz,selectedEntry:tD,modalRef:T,onClose:()=>ew(null),activeStateButtonClass:e=>{switch(e){case 1:return"border-emerald-200 bg-emerald-50 text-emerald-700";case 2:return"border-blue-200 bg-blue-50 text-blue-700";case 3:return"border-rose-200 bg-rose-50 text-rose-700";case 4:return"border-amber-200 bg-amber-50 text-amber-700";case 5:return"border-violet-200 bg-violet-50 text-violet-700";default:return"border-zinc-900 bg-zinc-900 text-white"}},justSaved:B===tz.isoDate,onStateChange:e=>{var t;tG(tz.isoDate,e,null!==(t=null==tD?void 0:tD.note)&&void 0!==t?t:"")},onNoteChange:e=>{var t;tG(tz.isoDate,null!==(t=null==tD?void 0:tD.state)&&void 0!==t?t:0,e)},onDelete:()=>{tV(tz.isoDate),ew(null)}}):null]})}}},function(e){e.O(0,[65,971,117,744],function(){return e(e.s=2732)}),_N_E=e.O()}]);